<!doctype html><html class="no-js" lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Installation Directions Doc</title><link rel="stylesheet" type="text/css" href="https://openenergydashboard.org/assets/css/styles_feeling_responsive.css"> <script src="https://openenergydashboard.org/assets/js/modernizr.min.js"></script> <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script> <script> WebFont.load({ google: { families: [ 'Lato:400,700,400italic:latin', 'Volkhov::latin' ] } }); </script> <noscript><link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7CVolkhov' rel='stylesheet' type='text/css'> </noscript><meta name="description" content="Version V1.0.0 Documentation overview Admin documentation Information Overview Standard Units Pages Units &amp; Conversions Site Management Conversion Creating Conversion Editing Conversion Viewing Group Creating Group Editing Group Map Creating Map Viewing Meter Creating Meter Editing Meter Viewing Site Settings Unit Creating Unit Editing Unit Viewing User Data Acquisition CSV Import Data Acquisition eGauge MAMAC Meter Import Reading Import Site Installation Production Install Output Installation Directions Upgrades Upgrades V1.0.0 User documentation User help Documentation versions for this page V1.0.0 (current page) V0.8.0 V0.7.0 These features are only available to select people who oversee the OED site (called admins) so this information is not usually of interest to a general user. This describes the installation of an OED site for production use. If one is a developer, you likely want to follow the directions on the getting started page. Requirements OED uses Unix, including Linux, features to work and run Docker. Most sites have servers running Unix/Linux and can directly run OED. MacOS is based on Unix and Docker can be installed directly as an application. Windows from Microsoft is not based on Unix so other steps are necessary. Given that Windows 10+ is generally needed to install OED and the fact that most systems run at least Windows 10, these directions assume the system is at that level of Windows. If one has Windows 10/11 Professional, Enterprise or Education, one should be able to directly install Docker via the Hyper-V though it may need to be enabled (this has not been tested by OED). If one has Windows 10/11 Home then one can use WSL 2 to enable Linux and then install Docker. Once Docker is installed and working, one can follow the direction given here since they only depend on Docker/docker compose. The developer getting started page has details on WSL and Docker installation. OED is installed using the Docker containerization tool. This allows it to be isolated from the rest of the system, and makes updates easier to perform, since the dependencies are all taken care of through the container definitions. Under Docker, OED is installed and administered using the docker compose command. One will need Docker version 19.03 or higher (since July 2019) but that should not be an issue if running any reasonably up-to-date version. Some versions of Linux already have Docker or it can be installed. Docker for MacOS is an app that can easily be installed. For Windows 10 Home one can see the link on the WSL page given in the previous step. General Docker installation information is available from Docker. It is assumed that the server is set up to respond to web requests (port 80) and that port 3000 is allowed (unless the default OED port is changed). It is also assumed the server can access the internet for the installation. These directions assume someone with root access to the server where OED is being installed and a working knowledge of doing Unix shell commands including editing text files. This is generally someone within the IT department of an organization. This guide requires that one enter some commands into an operating system shell, or terminal. On Windows, this is the terminal that connects to the Linux running under WSL. On MacOS, one can use Terminal.app (the default), iTerm2, or any other terminal program. On Linux, the distribution will provide a terminal; it can generally be opened with Ctrl+Shift+T or by searching for &quot;Terminal&quot; in the application menu. Installation Follow these steps to install a production (OED site for an organization) site: Clone the desired OED code from Github. Note if the directory is left off in the next step then the OED code will be placed in the current directory in the subdirectory OED. If &quot;.&quot; is used for the directory (just a period without the quotes) then the OED software will be placed directly into the current directory without a subdirectory. The OED software can be placed anywhere desired but the terminal should be using the desired directory before beginning the clone of the OED software. If a specific released version of OED is desired (this is most common) then do: git clone --branch &amp;lt;tag_name&amp;gt; https://github.com/OpenEnergyDashboard/OED.git [directory]. The officially released and tagged versions at the OED GitHub release page list all OED releases. In general, a site should take the latest release (at the top of the page). Note that the clone will not include git history (with detached head) but that should not be needed in a production environment. For example, to get release v1.0.0 in the subdirectory OED of the current directory do: git clone --branch v1.0.0 https://github.com/OpenEnergyDashboard/OED.git. After this there should be the directory OED where the clone was done. If a site wants the latest version from development then do: git clone https://github.com/OpenEnergyDashboard/OED.git [directory]. Note this will likely be code that has not yet gone through complete testing as done for an official release version but will have the latest OED code base. In general, production sites do not use this code. cd into the directory that has the cloned version of OED. This is known as the root directory of OED. It has a README.md file and others. Edit docker-compose.yml. Note that for values with an = one should not put spaces before or after the equal sign as is shown in the sample value. The edits are: POSTGRES_PASSWORD (under services: -&amp;gt; database: -&amp;gt; environment:) to a site specific password instead of the pleaseChange that is provided. Keep it secret but it should never need to known unless one wants to access the PostgreSQL database outside of the docker container. It will be: - POSTGRES_PASSWORD=whateverPasswordYouChoose OED_PRODUCTION (under services: -&amp;gt; web: -&amp;gt; environment:) to yes so it becomes: - OED_PRODUCTION=yes. OED_TOKEN_SECRET (under services: -&amp;gt; web: -&amp;gt; environment:) to a random value instead of the ? that is provided. Keep it secret but it should never need to known. It will be: - OED_TOKEN_SECRET=whateverTokenYouChoose The port (in services: -&amp;gt; web: -&amp;gt; ports:) for mapping from host to container; e.g., to host on the server&#39;s port 80, set it to 80:3000. This assumes the site wants to serve OED up on the standard web port. There are multiple lines here and some are commented out (begin with #). Before editing it should look like: ports: - &quot;3000:3000&quot; # Should be commented out if you uncomment 80:3000 below. - &quot;9229:9229&quot; # Debug port, should be commented out for production # For production you might want something like: # - &quot;80:3000&quot; # and comment out the debug port and 3000:3000 line above If the site wants to have standard web requests (port 80) serve up OED then edit to look like (comment out the debug port because it is not normally used in production): ports: # - &quot;3000:3000&quot; # Should be commented out if you uncomment 80:3000 below. # - &quot;9229:9229&quot; # Debug port, should be commented out for production # For production you might want something like: - &quot;80:3000&quot; # and comment out the debug port and 3000:3000 line above It is possible to use a different port. For example, if the line - &quot;3000:3000&quot; is uncommented and the line - &quot;9229:9229&quot; is commented out then OED will server up on port 3000 (where the line - &quot;80:3000&quot; is commented out). Later in these directions, it is suggested to set up a cron job to send an email to someone each day with any issues the OED installation encountered. No email is sent unless an issue is encountered. For this to work, OED needs to have access to a mail system (SMTP server) to send the mail. This is done by setting these environment values under services: -&amp;gt; web: -&amp;gt; environment: OED_MAIL_METHOD gives the way email is sent (SMTP). As the comment says this can be secure-smtp to use an SMTP server or none if the site is not going to have OED send mail alerts. OED only supports sending mail via secure channels. Note that the SMTP listed here does not have to relate to the mail recipient. In the end, this usually becomes OED_MAIL_METHOD=secure-smtp. OED_MAIL_SMTP gives the web address of the SMTP server for sending mail. For example, it could be OED_MAIL_SMTP=smtp.example.com where example.com would become the domain for your organization or one could use OED_MAIL_SMTP=smtp.gmail.com for Google Mail. OED_MAIL_SMTP_PORT gives the port number of the SMTP server for sending mail. For example, it is often OED_MAIL_SMTP_PORT=465 for the standard SSL connection port. OED_MAIL_IDENT gives the user name on the SMTP server where the mail will be sent. Replace someone@example.com with the user name email for sending mail. OED_MAIL_CREDENTIAL gives the password for the SMTP user in OED_MAIL_IDENT. Replace credential with that password. Note this setup cannot accommodate two factor authentication (2FA) unless given a token for the credential (an app password for mail for Google has been tested and it works). OED_MAIL_FROM gives the email address that the mail will be from. This is often the same as the OED_MAIL_IDENT so it might be OED_MAIL_FROM=mydomain@example.com where the desired email address is used. OED_MAIL_TO gives the email address of who will get the emails. Replace someone@example.com with the desired email. It can be the same as the SMTP email above or something different. OED_MAIL_ORG gives the organization name that will be part of the subject of the email sent. This may be important in recognizing the email, esp. if the person receiving it gets email from multiple OED sites (not common). Replace My Organization Name with whatever name is desired. For the remaining steps one needs to be the superuser/root to have sufficient permission to modify system files. Some OS setups allow the install step (next) without being the superuser but it is generally safer not to try. Make sure the terminal is in the root OED directory (where the README.md file is located). Install OED on the server by doing docker compose up. This will get all the needed software including Postgres, all node packages and then installs all the needed software. This can take from a minute to 10+ minutes depending on the speed of the server. The terminal will display a lot of output about installing the database (Postgres), getting needed packages (this can take a while so during this process there may not be more output for a while; this normally happens right after the &quot;database system is ready to accept connections&quot; output line) and starting up the web system (this can take a while so during this process there may not be more output for a while; this normally happens right after the &quot;webpack build --node-env production&quot; output line). Future builds will go much faster. When the terminal displays the lines: oed-web-1 | webpack 5.76.0 compiled successfully in 200210 ms oed-web-1 | OED install finished oed-web-1 | Starting OED in production mode oed-web-1 | oed-web-1 | &gt; open-energy-dashboard@1.0.0 start oed-web-1 | &gt; node ./src/bin/www oed-web-1 | oed-web-1 | [INFO@2023-10-20T11:22:35.803-05:00] Listening on port 3000 then OED should be ready to accept web requests. If there was an error in the output then OED might not be running properly. Please contact the OED project if there are questions where sending the terminal text is generally very helpful. The typical output of the install is available. A web browser can now be used to check that OED is properly serving up web pages. Use the web address oed.myinstition.org where oed.myinstition.org is replaced with the name of the server where OED is installed. If all is working properly, the main OED page (see Home Navigation documentation page for an image of what it will look like). The page won&#39;t be able to graph any data until the site has OED acquire meter data. If the mapping of 80:3000 was not done above, then OED would be reachable at oed.myinstition.org:3000. The site now needs to create an admin user to log into OED on the website. To do this, a second terminal is opened, go to the root OED directory and become a superuser/root user (as has been done). This is done so OED remains running in the first terminal to add the user. Run the script with: docker compose run web npm run createUser. The code will prompt to enter an email address and password: # docker compose run web npm run createUser Starting checkoed_database_1 ... done &gt; Open-Energy-Dashboard@0.6.0 createUser &gt; node ./src/server/services/user/createUser.js Email of user to create: someEmail@yourInstitution.org Password: passwordYouChoose [INFO@2021-10-13T21:40:31.853Z] User created or already exists where you replace someEmail@yourInstitution.org with any email (it does not have to be an active one) and passwordYouChoose with the password desired to use with this email to login into OED (passwords must be at least 8 characters long). It is important to remember this email &amp; password to access with OED admin features on the web pages. Run the command docker compose run web npm run editUser to change the password if forgotten or to create a new user. Note an OED admin user can create more users on the site so this is normally a one-time step. Note that OED echos what is typed so this information will be in the terminal. This terminal shouldn&#39;t be needed any more so it can be closed to hide the information or usually type clear to remove it from what is shown in the terminal. Now log in on the OED web page to make sure this account works. The options menu documentation is available but basically just click the &quot;Log in&quot; choice in the top, right of the OED website under &quot;Options&quot; and then enter the information. Shut down OED. Soon OED will be set up to run as a service so the OED currently running in the terminal should be shut down. In the terminal where OED was started (with docker compose up), do &quot;^c&quot; to shut down OED. Be a little patient since doing a second &quot;^c&quot; will cause a rapid stop of docker without the normal cleanup. The following steps require knowledge of the root directory path of OED. In the terminal located in the OED root directory do: pwd and the output will tell the directory path. Set up the daily cron job to email the OED admin with any issues that occurred in the past day. It is not required to do this but it is a very good idea. It gives someone a daily email of any issue so they are not missed. See above about needed values in docker-compose.yml to support sending emails. In the root OED directory do: cp src/scripts/sendLogEmailCron.bash /etc/cron.daily/sendLogEmailCron.bash Edit /etc/cron.daily/sendLogEmailCron.bash to make the necessary modifications to the script. See the script for more detail. Do: chmod +x /etc/cron.daily/sendLogEmailCron.bash to make the script executable. Set up the daily cron job to aggregate the daily readings needed for the fast data access OED does to the database. In the root OED directory do: cp src/scripts/refreshReadingViewsCron.bash /etc/cron.daily/refreshReadingViewsCron.bash Edit /etc/cron.daily/refreshReadingViewsCron.bash to make the necessary modifications to the script. See the script for more detail. Do: chmod +x /etc/cron.daily/refreshReadingViewsCron.bash to make the script executable. Set up the cron job to aggregate the hourly readings needed for the fast data access OED does to the database when zoomed in on data. The site can choose how frequently to do this. If the site wants to see the latest meter data quickly then this should be done hourly. Note the update takes a modest amount of CPU and can delay when users see data. If preferred, the site could run the script daily just before running the daily updates. This would mean the new hourly data would only become visible after the day completes. However, sites generally do not have issues with doing this every hour so it is normally done. In the root OED directory do (this assumes the site updates every hour): cp src/scripts/refreshHourlyReadingViewsCron.bash /etc/cron.hourly/refreshHourlyReadingViewsCron.bash Edit /etc/cron.daily/refreshHourlyReadingViewsCron.bash to make the necessary modifications to the script. See the script for more detail but it should be the same as the daily script changes. Do: chmod +x /etc/cron.hourly/refreshHourlyReadingViewsCron.bash to make the script executable. Set up the service so OED runs regularly on the server. There is a chance that the server version of Unix requires a modification of these steps. These steps should work on a Red Hat/Centos Unix. The &quot;User&quot; needed to set below is the one assigned to OED. It is the one logged into the terminal before becoming superuser/root and (hopefully not) the superuser/root. In the root OED directory do: cp src/scripts/oed.service /etc/systemd/system/oed.service Edit /etc/systemd/system/oed.service to make the necessary modifications to the script. See the script for more detail. Do: systemctl enable oed.service to make the service start on server boot. Assuming the site wants to start OED at this time do: systemctl start oed.service. Stop the app at any time by doing: systemctl stop oed.service but note it will restart on the next reboot unless this service is disabled with: systemctl disable oed.service. To check the status of the OED service do: systemctl list-units --type=service | grep -i oed. Note that OED needs to reinstall/restart whenever the service is started again so it will take a little while from the time this lists the service as loaded and active running until it is ready to serve up web pages. If one wants to check this is all set up correctly then restart the server and check it is still serving up web pages (as described above). Sometimes one wants to see the output of OED when it is running as a service. This can be useful during the install to see why OED did not come up. Do this by: Get the container ID by using: docker ps -a. The CONTAINER ID will be the one with the IMAGE of ...oed_web (where there may be some name in the ...) for the install/web output and IMAGE of ...oed_database for any database output. docker logs &amp;lt;CONTAINER ID&amp;gt; | more where &amp;lt;CONTAINER ID&amp;gt; is replaced with the value from the previous step. OED upgrades The OED project is regularly improving the code and releasing new versions of OED. To get the latest features, a site will probably want to upgrade OED over time. Information on officially released and tagged versions is given on the OED GitHub release page. If a newer version is desired then upgrade to it. Consult the directions on the OED Upgrading page. Admin setup The designated admin can use the login created above to set the desired features and items of OED. The following may be desired where the links can be used to get more information: Site preferences. Allows for setting of the site name, default actions on the graphic pages, creating other users, and certain limits among other things. data acquisition. Discusses getting meter data into OED so the site can display data. Standard units and conversions. Discusses the units and conversions provided by OED and making more of them visible to the user. Users. To create additional user logins and manage them. Admin features. Discusses the range of actions that admins can take and the related documentation pages. There are many OED features other than the ones linked directly above. Other information Though less likely, one may want to consult: Environment variable page about all the OED environment variables. NPM script page about the available scripts to support the OED setup. It is rare that the node/npm installation is not okay in a production environment. The OED installation detects if the node install already happened (because there is an up-to-date node_modules directory in the root OED directory) and skips doing it again to save time. However, a site can force OED to do the node install by going to the root OED directory and deleting the node_modules directory with: rm -rf node_modules/. Make sure OED is not running (see stopping the service above) before doing this since it will break the application. Redoing the OED install with docker compose up will recreate this directory."><meta name="google-site-verification" content="Vk0IOJ2jwG_qEoG7fuEXYqv0m2rLa8P778Fi_GrsgEQ"><meta name="msvalidate.01" content="0FB4C028ABCF07C908C54386ABD2D97F" ><link rel="canonical" href="https://openenergydashboard.org/helpV1_0_0/adminInstallation/"><meta property="og:title" content="Installation Directions Doc"><meta property="og:description" content="Version V1.0.0 Documentation overview Admin documentation Information Overview Standard Units Pages Units &amp; Conversions Site Management Conversion Creating Conversion Editing Conversion Viewing Group Creating Group Editing Group Map Creating Map Viewing Meter Creating Meter Editing Meter Viewing Site Settings Unit Creating Unit Editing Unit Viewing User Data Acquisition CSV Import Data Acquisition eGauge MAMAC Meter Import Reading Import Site Installation Production Install Output Installation Directions Upgrades Upgrades V1.0.0 User documentation User help Documentation versions for this page V1.0.0 (current page) V0.8.0 V0.7.0 These features are only available to select people who oversee the OED site (called admins) so this information is not usually of interest to a general user. This describes the installation of an OED site for production use. If one is a developer, you likely want to follow the directions on the getting started page. Requirements OED uses Unix, including Linux, features to work and run Docker. Most sites have servers running Unix/Linux and can directly run OED. MacOS is based on Unix and Docker can be installed directly as an application. Windows from Microsoft is not based on Unix so other steps are necessary. Given that Windows 10+ is generally needed to install OED and the fact that most systems run at least Windows 10, these directions assume the system is at that level of Windows. If one has Windows 10/11 Professional, Enterprise or Education, one should be able to directly install Docker via the Hyper-V though it may need to be enabled (this has not been tested by OED). If one has Windows 10/11 Home then one can use WSL 2 to enable Linux and then install Docker. Once Docker is installed and working, one can follow the direction given here since they only depend on Docker/docker compose. The developer getting started page has details on WSL and Docker installation. OED is installed using the Docker containerization tool. This allows it to be isolated from the rest of the system, and makes updates easier to perform, since the dependencies are all taken care of through the container definitions. Under Docker, OED is installed and administered using the docker compose command. One will need Docker version 19.03 or higher (since July 2019) but that should not be an issue if running any reasonably up-to-date version. Some versions of Linux already have Docker or it can be installed. Docker for MacOS is an app that can easily be installed. For Windows 10 Home one can see the link on the WSL page given in the previous step. General Docker installation information is available from Docker. It is assumed that the server is set up to respond to web requests (port 80) and that port 3000 is allowed (unless the default OED port is changed). It is also assumed the server can access the internet for the installation. These directions assume someone with root access to the server where OED is being installed and a working knowledge of doing Unix shell commands including editing text files. This is generally someone within the IT department of an organization. This guide requires that one enter some commands into an operating system shell, or terminal. On Windows, this is the terminal that connects to the Linux running under WSL. On MacOS, one can use Terminal.app (the default), iTerm2, or any other terminal program. On Linux, the distribution will provide a terminal; it can generally be opened with Ctrl+Shift+T or by searching for &quot;Terminal&quot; in the application menu. Installation Follow these steps to install a production (OED site for an organization) site: Clone the desired OED code from Github. Note if the directory is left off in the next step then the OED code will be placed in the current directory in the subdirectory OED. If &quot;.&quot; is used for the directory (just a period without the quotes) then the OED software will be placed directly into the current directory without a subdirectory. The OED software can be placed anywhere desired but the terminal should be using the desired directory before beginning the clone of the OED software. If a specific released version of OED is desired (this is most common) then do: git clone --branch &amp;lt;tag_name&amp;gt; https://github.com/OpenEnergyDashboard/OED.git [directory]. The officially released and tagged versions at the OED GitHub release page list all OED releases. In general, a site should take the latest release (at the top of the page). Note that the clone will not include git history (with detached head) but that should not be needed in a production environment. For example, to get release v1.0.0 in the subdirectory OED of the current directory do: git clone --branch v1.0.0 https://github.com/OpenEnergyDashboard/OED.git. After this there should be the directory OED where the clone was done. If a site wants the latest version from development then do: git clone https://github.com/OpenEnergyDashboard/OED.git [directory]. Note this will likely be code that has not yet gone through complete testing as done for an official release version but will have the latest OED code base. In general, production sites do not use this code. cd into the directory that has the cloned version of OED. This is known as the root directory of OED. It has a README.md file and others. Edit docker-compose.yml. Note that for values with an = one should not put spaces before or after the equal sign as is shown in the sample value. The edits are: POSTGRES_PASSWORD (under services: -&amp;gt; database: -&amp;gt; environment:) to a site specific password instead of the pleaseChange that is provided. Keep it secret but it should never need to known unless one wants to access the PostgreSQL database outside of the docker container. It will be: - POSTGRES_PASSWORD=whateverPasswordYouChoose OED_PRODUCTION (under services: -&amp;gt; web: -&amp;gt; environment:) to yes so it becomes: - OED_PRODUCTION=yes. OED_TOKEN_SECRET (under services: -&amp;gt; web: -&amp;gt; environment:) to a random value instead of the ? that is provided. Keep it secret but it should never need to known. It will be: - OED_TOKEN_SECRET=whateverTokenYouChoose The port (in services: -&amp;gt; web: -&amp;gt; ports:) for mapping from host to container; e.g., to host on the server&#39;s port 80, set it to 80:3000. This assumes the site wants to serve OED up on the standard web port. There are multiple lines here and some are commented out (begin with #). Before editing it should look like: ports: - &quot;3000:3000&quot; # Should be commented out if you uncomment 80:3000 below. - &quot;9229:9229&quot; # Debug port, should be commented out for production # For production you might want something like: # - &quot;80:3000&quot; # and comment out the debug port and 3000:3000 line above If the site wants to have standard web requests (port 80) serve up OED then edit to look like (comment out the debug port because it is not normally used in production): ports: # - &quot;3000:3000&quot; # Should be commented out if you uncomment 80:3000 below. # - &quot;9229:9229&quot; # Debug port, should be commented out for production # For production you might want something like: - &quot;80:3000&quot; # and comment out the debug port and 3000:3000 line above It is possible to use a different port. For example, if the line - &quot;3000:3000&quot; is uncommented and the line - &quot;9229:9229&quot; is commented out then OED will server up on port 3000 (where the line - &quot;80:3000&quot; is commented out). Later in these directions, it is suggested to set up a cron job to send an email to someone each day with any issues the OED installation encountered. No email is sent unless an issue is encountered. For this to work, OED needs to have access to a mail system (SMTP server) to send the mail. This is done by setting these environment values under services: -&amp;gt; web: -&amp;gt; environment: OED_MAIL_METHOD gives the way email is sent (SMTP). As the comment says this can be secure-smtp to use an SMTP server or none if the site is not going to have OED send mail alerts. OED only supports sending mail via secure channels. Note that the SMTP listed here does not have to relate to the mail recipient. In the end, this usually becomes OED_MAIL_METHOD=secure-smtp. OED_MAIL_SMTP gives the web address of the SMTP server for sending mail. For example, it could be OED_MAIL_SMTP=smtp.example.com where example.com would become the domain for your organization or one could use OED_MAIL_SMTP=smtp.gmail.com for Google Mail. OED_MAIL_SMTP_PORT gives the port number of the SMTP server for sending mail. For example, it is often OED_MAIL_SMTP_PORT=465 for the standard SSL connection port. OED_MAIL_IDENT gives the user name on the SMTP server where the mail will be sent. Replace someone@example.com with the user name email for sending mail. OED_MAIL_CREDENTIAL gives the password for the SMTP user in OED_MAIL_IDENT. Replace credential with that password. Note this setup cannot accommodate two factor authentication (2FA) unless given a token for the credential (an app password for mail for Google has been tested and it works). OED_MAIL_FROM gives the email address that the mail will be from. This is often the same as the OED_MAIL_IDENT so it might be OED_MAIL_FROM=mydomain@example.com where the desired email address is used. OED_MAIL_TO gives the email address of who will get the emails. Replace someone@example.com with the desired email. It can be the same as the SMTP email above or something different. OED_MAIL_ORG gives the organization name that will be part of the subject of the email sent. This may be important in recognizing the email, esp. if the person receiving it gets email from multiple OED sites (not common). Replace My Organization Name with whatever name is desired. For the remaining steps one needs to be the superuser/root to have sufficient permission to modify system files. Some OS setups allow the install step (next) without being the superuser but it is generally safer not to try. Make sure the terminal is in the root OED directory (where the README.md file is located). Install OED on the server by doing docker compose up. This will get all the needed software including Postgres, all node packages and then installs all the needed software. This can take from a minute to 10+ minutes depending on the speed of the server. The terminal will display a lot of output about installing the database (Postgres), getting needed packages (this can take a while so during this process there may not be more output for a while; this normally happens right after the &quot;database system is ready to accept connections&quot; output line) and starting up the web system (this can take a while so during this process there may not be more output for a while; this normally happens right after the &quot;webpack build --node-env production&quot; output line). Future builds will go much faster. When the terminal displays the lines: oed-web-1 | webpack 5.76.0 compiled successfully in 200210 ms oed-web-1 | OED install finished oed-web-1 | Starting OED in production mode oed-web-1 | oed-web-1 | &gt; open-energy-dashboard@1.0.0 start oed-web-1 | &gt; node ./src/bin/www oed-web-1 | oed-web-1 | [INFO@2023-10-20T11:22:35.803-05:00] Listening on port 3000 then OED should be ready to accept web requests. If there was an error in the output then OED might not be running properly. Please contact the OED project if there are questions where sending the terminal text is generally very helpful. The typical output of the install is available. A web browser can now be used to check that OED is properly serving up web pages. Use the web address oed.myinstition.org where oed.myinstition.org is replaced with the name of the server where OED is installed. If all is working properly, the main OED page (see Home Navigation documentation page for an image of what it will look like). The page won&#39;t be able to graph any data until the site has OED acquire meter data. If the mapping of 80:3000 was not done above, then OED would be reachable at oed.myinstition.org:3000. The site now needs to create an admin user to log into OED on the website. To do this, a second terminal is opened, go to the root OED directory and become a superuser/root user (as has been done). This is done so OED remains running in the first terminal to add the user. Run the script with: docker compose run web npm run createUser. The code will prompt to enter an email address and password: # docker compose run web npm run createUser Starting checkoed_database_1 ... done &gt; Open-Energy-Dashboard@0.6.0 createUser &gt; node ./src/server/services/user/createUser.js Email of user to create: someEmail@yourInstitution.org Password: passwordYouChoose [INFO@2021-10-13T21:40:31.853Z] User created or already exists where you replace someEmail@yourInstitution.org with any email (it does not have to be an active one) and passwordYouChoose with the password desired to use with this email to login into OED (passwords must be at least 8 characters long). It is important to remember this email &amp; password to access with OED admin features on the web pages. Run the command docker compose run web npm run editUser to change the password if forgotten or to create a new user. Note an OED admin user can create more users on the site so this is normally a one-time step. Note that OED echos what is typed so this information will be in the terminal. This terminal shouldn&#39;t be needed any more so it can be closed to hide the information or usually type clear to remove it from what is shown in the terminal. Now log in on the OED web page to make sure this account works. The options menu documentation is available but basically just click the &quot;Log in&quot; choice in the top, right of the OED website under &quot;Options&quot; and then enter the information. Shut down OED. Soon OED will be set up to run as a service so the OED currently running in the terminal should be shut down. In the terminal where OED was started (with docker compose up), do &quot;^c&quot; to shut down OED. Be a little patient since doing a second &quot;^c&quot; will cause a rapid stop of docker without the normal cleanup. The following steps require knowledge of the root directory path of OED. In the terminal located in the OED root directory do: pwd and the output will tell the directory path. Set up the daily cron job to email the OED admin with any issues that occurred in the past day. It is not required to do this but it is a very good idea. It gives someone a daily email of any issue so they are not missed. See above about needed values in docker-compose.yml to support sending emails. In the root OED directory do: cp src/scripts/sendLogEmailCron.bash /etc/cron.daily/sendLogEmailCron.bash Edit /etc/cron.daily/sendLogEmailCron.bash to make the necessary modifications to the script. See the script for more detail. Do: chmod +x /etc/cron.daily/sendLogEmailCron.bash to make the script executable. Set up the daily cron job to aggregate the daily readings needed for the fast data access OED does to the database. In the root OED directory do: cp src/scripts/refreshReadingViewsCron.bash /etc/cron.daily/refreshReadingViewsCron.bash Edit /etc/cron.daily/refreshReadingViewsCron.bash to make the necessary modifications to the script. See the script for more detail. Do: chmod +x /etc/cron.daily/refreshReadingViewsCron.bash to make the script executable. Set up the cron job to aggregate the hourly readings needed for the fast data access OED does to the database when zoomed in on data. The site can choose how frequently to do this. If the site wants to see the latest meter data quickly then this should be done hourly. Note the update takes a modest amount of CPU and can delay when users see data. If preferred, the site could run the script daily just before running the daily updates. This would mean the new hourly data would only become visible after the day completes. However, sites generally do not have issues with doing this every hour so it is normally done. In the root OED directory do (this assumes the site updates every hour): cp src/scripts/refreshHourlyReadingViewsCron.bash /etc/cron.hourly/refreshHourlyReadingViewsCron.bash Edit /etc/cron.daily/refreshHourlyReadingViewsCron.bash to make the necessary modifications to the script. See the script for more detail but it should be the same as the daily script changes. Do: chmod +x /etc/cron.hourly/refreshHourlyReadingViewsCron.bash to make the script executable. Set up the service so OED runs regularly on the server. There is a chance that the server version of Unix requires a modification of these steps. These steps should work on a Red Hat/Centos Unix. The &quot;User&quot; needed to set below is the one assigned to OED. It is the one logged into the terminal before becoming superuser/root and (hopefully not) the superuser/root. In the root OED directory do: cp src/scripts/oed.service /etc/systemd/system/oed.service Edit /etc/systemd/system/oed.service to make the necessary modifications to the script. See the script for more detail. Do: systemctl enable oed.service to make the service start on server boot. Assuming the site wants to start OED at this time do: systemctl start oed.service. Stop the app at any time by doing: systemctl stop oed.service but note it will restart on the next reboot unless this service is disabled with: systemctl disable oed.service. To check the status of the OED service do: systemctl list-units --type=service | grep -i oed. Note that OED needs to reinstall/restart whenever the service is started again so it will take a little while from the time this lists the service as loaded and active running until it is ready to serve up web pages. If one wants to check this is all set up correctly then restart the server and check it is still serving up web pages (as described above). Sometimes one wants to see the output of OED when it is running as a service. This can be useful during the install to see why OED did not come up. Do this by: Get the container ID by using: docker ps -a. The CONTAINER ID will be the one with the IMAGE of ...oed_web (where there may be some name in the ...) for the install/web output and IMAGE of ...oed_database for any database output. docker logs &amp;lt;CONTAINER ID&amp;gt; | more where &amp;lt;CONTAINER ID&amp;gt; is replaced with the value from the previous step. OED upgrades The OED project is regularly improving the code and releasing new versions of OED. To get the latest features, a site will probably want to upgrade OED over time. Information on officially released and tagged versions is given on the OED GitHub release page. If a newer version is desired then upgrade to it. Consult the directions on the OED Upgrading page. Admin setup The designated admin can use the login created above to set the desired features and items of OED. The following may be desired where the links can be used to get more information: Site preferences. Allows for setting of the site name, default actions on the graphic pages, creating other users, and certain limits among other things. data acquisition. Discusses getting meter data into OED so the site can display data. Standard units and conversions. Discusses the units and conversions provided by OED and making more of them visible to the user. Users. To create additional user logins and manage them. Admin features. Discusses the range of actions that admins can take and the related documentation pages. There are many OED features other than the ones linked directly above. Other information Though less likely, one may want to consult: Environment variable page about all the OED environment variables. NPM script page about the available scripts to support the OED setup. It is rare that the node/npm installation is not okay in a production environment. The OED installation detects if the node install already happened (because there is an up-to-date node_modules directory in the root OED directory) and skips doing it again to save time. However, a site can force OED to do the node install by going to the root OED directory and deleting the node_modules directory with: rm -rf node_modules/. Make sure OED is not running (see stopping the service above) before doing this since it will break the application. Redoing the OED install with docker compose up will recreate this directory."><meta property="og:url" content="https://openenergydashboard.org/helpV1_0_0/adminInstallation/"><meta property="og:locale" content="en_EN"><meta property="og:type" content="website"><meta property="og:site_name" content="Open Energy Dashboard"><link rel="icon" sizes="32x32" href="https://openenergydashboard.org/assets/img/OEDIcon22x32.png"><link rel="icon" sizes="192x192" href="https://openenergydashboard.org/assets/img/OEDIcon192x274.png"><body id="top-of-page" class="page-fullwidth"><div id="navigation" class="sticky"><nav class="top-bar" role="navigation" data-topbar data-options="scrolltop: false"><ul class="title-area"><li class="name"><h1 class="hide-for-large-up"><a href="https://openenergydashboard.org/" class="icon-tree"> Open Energy Dashboard</a></h1><li class="toggle-topbar toggle-topbar-click menu-icon"><a><span>Nav</span></a></ul><section class="top-bar-section"><ul class="left"><li><a href="https://openenergydashboard.org/">home</a><li class="divider"><li class="has-dropdown"> <a href="https://openenergydashboard.org/features/">features</a><ul class="dropdown"><li><a href="https://openenergydashboard.org/features/">features by type</a><li><a href="https://openenergydashboard.org/useAcademic/">features by academic use</a></ul><li class="divider"><li class="has-dropdown"> <a href="https://openenergydashboard.org/helpV1_0_0/user/">Documentation</a><ul class="dropdown"><li><a href="https://openenergydashboard.org/helpV1_0_0/user/">oed version 1.0.0</a><li><a href="https://openenergydashboard.org/helpV0_8_0/user/">oed version 0.8.0</a><li><a href="https://openenergydashboard.org/helpV0_7_0/user/">oed version 0.7.0</a><li><a href="https://openenergydashboard.org/helpV0_6_0/user/">oed version 0.6.0</a></ul><li class="divider"><li><a href="https://openenergydashboard.org/use/">Adopting</a><li class="divider"><li class="has-dropdown"> <a href="https://openenergydashboard.org/news/">info</a><ul class="dropdown"><li><a href="https://openenergydashboard.org/news/">news</a><li><a href="https://openenergydashboard.org/principles/">project principles</a><li><a href="https://openenergydashboard.org/free/">free &amp; maintained</a><li><a href="https://openenergydashboard.org/mission/">mission</a><li><a href="https://openenergydashboard.org/why/">why exists</a><li><a href="https://openenergydashboard.org/projectInfo/">project information pages &amp; license</a><li><a href="https://openenergydashboard.org/name/">why OED name, logo &amp; some history</a></ul><li class="divider"></ul><ul class="right"><li class="divider"><li><a href="https://openenergydashboard.org/search/">Search</a><li class="divider"><li><a href="https://openenergydashboard.org/contact/">Contact</a><li class="divider"><li><a href="https://openenergydashboard.org/developer/developer/">developer docs</a><li class="divider"><li class="has-dropdown"> <a href="https://openenergydashboard.org/involved/">get involved</a><ul class="dropdown"><li><a href="https://openenergydashboard.org/internship/">becoming a developer</a><li><a href="https://openenergydashboard.org/studentExperience/">student experience</a></ul></ul></section></nav></div><div id="masthead-no-image-header"><div class="row"><div class="small-6 small-centered columns"> <a id="logo" title="Open Energy Dashboard – A Free, Open Source Energy/Resource Dashboard"> <img src="https://openenergydashboard.org/assets/img/logoHelp.png" alt="Open Energy Dashboard – A Free, Open Source Energy/Resource Dashboard"> </a></div></div></div><nav class="breadcrumbs" role="menubar" aria-label="breadcrumbs"> <a href="https://openenergydashboard.org/">Start</a> <a href="https://openenergydashboard.org/helpV1_0_0/">helpV1_0_0</a> <a class="current">Installation Directions</a></nav><div class="row t15"><div class="medium-12 columns"><article><header><p class="subheadline">OED Documentation<h1>Installation Directions</h1></header><div class="row"><p>Version V1.0.0<div class="medium-4 medium-push-8 columns" markdown="1"><div class="panel radius" markdown="1"><div style="list-style: none;" class="side-nav"><h4><a href='../admin/'>Documentation overview</a></h4><div><h5>Admin documentation</h5><div style="padding-left: 1em;"><h6>Information</h6><div style="padding-left: 1em;"> <a href="https://openenergydashboard.org/helpV1_0_0/admin/">Overview</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminOedUnits/">Standard Units</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminPageChoices/">Pages</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminUnitInfo/">Units & Conversions</a></br></div></div><div style="padding-left: 1em;"><h6>Site Management</h6><div style="padding-left: 1em;"> <a href="https://openenergydashboard.org/helpV1_0_0/adminConversionCreating/">Conversion Creating</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminConversionEditing/">Conversion Editing</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminConversionViewing/">Conversion Viewing</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminGroupCreating/">Group Creating</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminGroupEditing/">Group Editing</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminGroupViewing/">Group</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminMapCreating/">Map Creating</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminMapViewing/">Map Viewing</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminMeterCreating/">Meter Creating</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminMeterEditing/">Meter Editing</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminMeterViewing/">Meter Viewing</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminPreferences/">Site Settings</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminUnitCreating/">Unit Creating</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminUnitEditing/">Unit Editing</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminUnitViewing/">Unit Viewing</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminUser/">User</a></br></div></div><div style="padding-left: 1em;"><h6>Data Acquisition</h6><div style="padding-left: 1em;"> <a href="https://openenergydashboard.org/helpV1_0_0/adminCsvImport/">CSV Import</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminDataAcquisition/">Data Acquisition</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminEgauge/">eGauge</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminMamac/">MAMAC</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminMetersImport/">Meter Import</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminReadingsImport/">Reading Import</a></br></div></div><div style="padding-left: 1em;"><h6>Site Installation</h6><div style="padding-left: 1em;"> <a href="https://openenergydashboard.org/helpV1_0_0/adminInstallOutput/">Production Install Output</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminInstallation/">Installation Directions</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminUpgrading/">Upgrades</a></br> <a href="https://openenergydashboard.org/helpV1_0_0/adminUpgradingV1/">Upgrades V1.0.0</a></br></div></div><h5>User documentation</h5><div style="padding-left: 1em;"> <a href="https://openenergydashboard.org/helpV1_0_0/adminInstallation/../user/">User help</a></br></div><h5>Documentation versions for this page</h5><div style="padding-left: 1em;"> V1.0.0 (current page)</br> <a href="../../helpV0_8_0/adminInstallation/">V0.8.0</a></br> <a href="../../helpV0_7_0/adminInstallation/">V0.7.0</a></br></div></div></div></div></div><div class="medium-8 medium-pull-4 columns" markdown="1"><div class="alert-box info "><p>These features are only available to select people who oversee the OED site (called admins) so this information is not usually of interest to a general user.</div><p>This describes the installation of an OED site for production use. If one is a developer, you likely want to follow the directions on the <a href="https://openenergydashboard.org/developer/gettingStarted/">getting started</a> page.<h2>Requirements</h2><p>OED uses Unix, including Linux, features to work and run Docker. Most sites have servers running Unix/Linux and can directly run OED. MacOS is based on Unix and Docker can be installed directly as an application. Windows from Microsoft is not based on Unix so other steps are necessary. Given that Windows 10+ is generally needed to install OED and the fact that most systems run at least Windows 10, these directions assume the system is at that level of Windows. If one has Windows 10/11 Professional, Enterprise or Education, one should be able to directly install Docker via the Hyper-V though it may need to be enabled (this has not been tested by OED). If one has Windows 10/11 Home then one can use WSL 2 to enable Linux and then install Docker. Once Docker is installed and working, one can follow the direction given here since they only depend on Docker/docker compose. The <a href="https://openenergydashboard.org/developer/gettingStarted/">developer getting started page</a> has details on WSL and Docker installation.<p>OED is installed using the Docker containerization tool. This allows it to be isolated from the rest of the system, and makes updates easier to perform, since the dependencies are all taken care of through the container definitions. Under Docker, OED is installed and administered using the <code>docker compose</code> command. One will need Docker version 19.03 or higher (since July 2019) but that should not be an issue if running any reasonably up-to-date version. Some versions of Linux already have Docker or it can be installed. Docker for MacOS is an app that can easily be installed. For Windows 10 Home one can see the link on the WSL page given in the previous step. General Docker installation information is available from <a href="https://docs.docker.com/engine/install/" rel="nofollow">Docker</a>.<p>It is assumed that the server is set up to respond to web requests (port 80) and that port 3000 is allowed (unless the default OED port is changed). It is also assumed the server can access the internet for the installation.<p>These directions assume someone with root access to the server where OED is being installed and a working knowledge of doing Unix shell commands including editing text files. This is generally someone within the IT department of an organization.<p>This guide requires that one enter some commands into an operating system shell, or terminal.<ul><li>On Windows, this is the terminal that connects to the Linux running under WSL.<li>On MacOS, one can use Terminal.app (the default), iTerm2, or any other terminal program.<li>On Linux, the distribution will provide a terminal; it can generally be opened with Ctrl+Shift+T or by searching for "Terminal" in the application menu.</ul><h2>Installation</h2><p>Follow these steps to install a production (OED site for an organization) site:<ol><li><p>Clone the desired OED code from Github. Note if the <code>directory</code> is left off in the next step then the OED code will be placed in the current directory in the subdirectory OED. If "." is used for the <code>directory</code> (just a period without the quotes) then the OED software will be placed directly into the current directory without a subdirectory. The OED software can be placed anywhere desired but the terminal should be using the desired directory before beginning the clone of the OED software.<ul><li>If a specific released version of OED is desired (this is most common) then do: <code>git clone --branch &lt;tag_name&gt; https://github.com/OpenEnergyDashboard/OED.git [directory]</code>. The officially released and tagged versions at the <a href="https://github.com/OpenEnergyDashboard/OED/releases" rel="noopener noreferrer">OED GitHub release page</a> list all OED releases. In general, a site should take the latest release (at the top of the page). Note that the clone will not include git history (with detached head) but that should not be needed in a production environment. For example, to get release v1.0.0 in the subdirectory OED of the current directory do: <code>git clone --branch v1.0.0 https://github.com/OpenEnergyDashboard/OED.git</code>. After this there should be the directory OED where the clone was done.<li>If a site wants the latest version from development then do: <code>git clone https://github.com/OpenEnergyDashboard/OED.git [directory]</code>. Note this will likely be code that has not yet gone through complete testing as done for an official release version but will have the latest OED code base. In general, production sites do not use this code.</ul><li>cd into the directory that has the cloned version of OED. This is known as the root directory of OED. It has a README.md file and others.<li><p>Edit <code>docker-compose.yml</code>. Note that for values with an = one should not put spaces before or after the equal sign as is shown in the sample value. The edits are:<ol type="a"><li>POSTGRES_PASSWORD (under <code>services: -&gt; database: -&gt; environment:</code>) to a site specific password instead of the <code>pleaseChange</code> that is provided. Keep it secret but it should never need to known unless one wants to access the PostgreSQL database outside of the docker container. It will be: <code>- POSTGRES_PASSWORD=whateverPasswordYouChoose</code><li>OED_PRODUCTION (under <code>services: -&gt; web: -&gt; environment:</code>) to <code>yes</code> so it becomes: <code>- OED_PRODUCTION=yes</code>.<li>OED_TOKEN_SECRET (under <code>services: -&gt; web: -&gt; environment:</code>) to a random value instead of the <code>?</code> that is provided. Keep it secret but it should never need to known. It will be: <code>- OED_TOKEN_SECRET=whateverTokenYouChoose</code><li>The port (in <code>services: -&gt; web: -&gt; ports:</code>) for mapping from host to container; e.g., to host on the server's port 80, set it to <code>80:3000</code>. This assumes the site wants to serve OED up on the standard web port. There are multiple lines here and some are commented out (begin with <code>#</code>). Before editing it should look like:<pre><code>
    ports:
        - "3000:3000" # Should be commented out if you uncomment 80:3000 below.
        - "9229:9229" # Debug port, should be commented out for production
        # For production you might want something like:
        # - "80:3000"
        # and comment out the debug port and 3000:3000 line above
                </code></pre><p>If the site wants to have standard web requests (port 80) serve up OED then edit to look like (comment out the debug port because it is not normally used in production):<pre><code>
    ports:
        # - "3000:3000" # Should be commented out if you uncomment 80:3000 below.
        # - "9229:9229" # Debug port, should be commented out for production
        # For production you might want something like:
        - "80:3000"
        # and comment out the debug port and 3000:3000 line above
                </code></pre><p>It is possible to use a different port. For example, if the line <code>- "3000:3000"</code> is uncommented and the line <code>- "9229:9229"</code> is commented out then OED will server up on port 3000 (where the line <code>- "80:3000"</code> is commented out).<li>Later in these directions, it is suggested to set up a cron job to send an email to someone each day with any issues the OED installation encountered. No email is sent unless an issue is encountered. For this to work, OED needs to have access to a mail system (SMTP server) to send the mail. This is done by setting these environment values under <code>services: -&gt; web: -&gt; environment:</code><ul><li>OED_MAIL_METHOD gives the way email is sent (SMTP). As the comment says this can be <code>secure-smtp</code> to use an SMTP server or <code>none</code> if the site is not going to have OED send mail alerts. OED only supports sending mail via secure channels. Note that the SMTP listed here does not have to relate to the mail recipient. In the end, this usually becomes <code>OED_MAIL_METHOD=secure-smtp</code>.<li>OED_MAIL_SMTP gives the web address of the SMTP server for sending mail. For example, it could be <code>OED_MAIL_SMTP=smtp.example.com</code> where example.com would become the domain for your organization or one could use <code>OED_MAIL_SMTP=smtp.gmail.com</code> for Google Mail.<li>OED_MAIL_SMTP_PORT gives the port number of the SMTP server for sending mail. For example, it is often <code>OED_MAIL_SMTP_PORT=465</code> for the standard SSL connection port.<li>OED_MAIL_IDENT gives the user name on the SMTP server where the mail will be sent. Replace <code>someone@example.com</code> with the user name email for sending mail.<li>OED_MAIL_CREDENTIAL gives the password for the SMTP user in OED_MAIL_IDENT. Replace <code>credential</code> with that password. Note this setup cannot accommodate two factor authentication (2FA) unless given a token for the credential (an app password for mail for Google has been tested and it works).<li>OED_MAIL_FROM gives the email address that the mail will be from. This is often the same as the OED_MAIL_IDENT so it might be <code>OED_MAIL_FROM=mydomain@example.com</code> where the desired email address is used.<li>OED_MAIL_TO gives the email address of who will get the emails. Replace <code>someone@example.com</code> with the desired email. It can be the same as the SMTP email above or something different.<li>OED_MAIL_ORG gives the organization name that will be part of the subject of the email sent. This may be important in recognizing the email, esp. if the person receiving it gets email from multiple OED sites (not common). Replace <code>My Organization Name</code> with whatever name is desired.</ul></ol><li>For the remaining steps one needs to be the superuser/root to have sufficient permission to modify system files. Some OS setups allow the install step (next) without being the superuser but it is generally safer not to try.<li>Make sure the terminal is in the root OED directory (where the README.md file is located).<li>Install OED on the server by doing <code>docker compose up</code>. This will get all the needed software including Postgres, all node packages and then installs all the needed software. This can take from a minute to 10+ minutes depending on the speed of the server. The terminal will display a lot of output about installing the database (Postgres), getting needed packages (<strong>this can take a while so during this process there may not be more output for a while</strong>; this normally happens right after the "database system is ready to accept connections" output line) and starting up the web system (<strong>this can take a while so during this process there may not be more output for a while</strong>; this normally happens right after the "webpack build --node-env production" output line). Future builds will go much faster. When the terminal displays the lines:<pre>
oed-web-1       | webpack 5.76.0 compiled successfully in 200210 ms
oed-web-1       | OED install finished
oed-web-1       | Starting OED in production mode
oed-web-1       | 
oed-web-1       | > open-energy-dashboard@1.0.0 start
oed-web-1       | > node ./src/bin/www
oed-web-1       | 
oed-web-1       | [INFO@2023-10-20T11:22:35.803-05:00] Listening on port 3000
            </pre>then OED should be ready to accept web requests. If there was an error in the output then OED might not be running properly. Please contact the OED project if there are questions where sending the terminal text is generally very helpful.</ol><p>The <a href="../adminInstallOutput/">typical output of the install</a> is available.<ol start="7"><li>A web browser can now be used to check that OED is properly serving up web pages. Use the web address <code>oed.myinstition.org</code> where oed.myinstition.org is replaced with the name of the server where OED is installed. If all is working properly, the main OED page (see <a href="../home/">Home Navigation</a> documentation page for an image of what it will look like). The page won't be able to graph any data until the site has OED acquire meter data. If the mapping of 80:3000 was not done above, then OED would be reachable at <code>oed.myinstition.org:3000</code>.<li>The site now needs to create an admin user to log into OED on the website. To do this, a second terminal is opened, go to the root OED directory and become a superuser/root user (as has been done). This is done so OED remains running in the first terminal to add the user. Run the script with: <code>docker compose run web npm run createUser</code>. The code will prompt to enter an email address and password:<pre>
# docker compose run web npm run createUser
Starting checkoed_database_1 ... done

> Open-Energy-Dashboard@0.6.0 createUser
> node ./src/server/services/user/createUser.js

Email of user to create: someEmail@yourInstitution.org
Password: passwordYouChoose
[INFO@2021-10-13T21:40:31.853Z] User created or already exists
            </pre><p>where you replace <code>someEmail@yourInstitution.org</code> with any email (it does not have to be an active one) and <code>passwordYouChoose</code> with the password desired to use with this email to login into OED (passwords must be at least 8 characters long). It is important to remember this email & password to access with OED admin features on the web pages. Run the command <code>docker compose run web npm run editUser</code> to change the password if forgotten or to create a new user. Note an OED admin user can create more users on the site so this is normally a one-time step.<p>Note that OED echos what is typed so this information will be in the terminal. This terminal shouldn't be needed any more so it can be closed to hide the information or usually type <code>clear</code> to remove it from what is shown in the terminal.<p>Now log in on the OED web page to make sure this account works. The <a href="../optionsMenu/">options menu</a> documentation is available but basically just click the "Log in" choice in the top, right of the OED website under "Options" and then enter the information.<li>Shut down OED. Soon OED will be set up to run as a service so the OED currently running in the terminal should be shut down. In the terminal where OED was started (with <code>docker compose up</code>), do "^c" to shut down OED. Be a little patient since doing a second "^c" will cause a rapid stop of docker without the normal cleanup.<li>The following steps require knowledge of the root directory path of OED. In the terminal located in the OED root directory do: <code>pwd</code> and the output will tell the directory path.<li><p>Set up the daily cron job to email the OED admin with any issues that occurred in the past day. It is not required to do this but it is a very good idea. It gives someone a daily email of any issue so they are not missed. See above about needed values in docker-compose.yml to support sending emails.<ol><li>In the root OED directory do: <code>cp src/scripts/sendLogEmailCron.bash /etc/cron.daily/sendLogEmailCron.bash</code><li>Edit /etc/cron.daily/sendLogEmailCron.bash to make the necessary modifications to the script. See the script for more detail.<li>Do: <code>chmod +x /etc/cron.daily/sendLogEmailCron.bash</code> to make the script executable.</ol><li><p>Set up the daily cron job to aggregate the daily readings needed for the fast data access OED does to the database.<ol><li>In the root OED directory do: <code>cp src/scripts/refreshReadingViewsCron.bash /etc/cron.daily/refreshReadingViewsCron.bash</code><li>Edit /etc/cron.daily/refreshReadingViewsCron.bash to make the necessary modifications to the script. See the script for more detail.<li>Do: <code>chmod +x /etc/cron.daily/refreshReadingViewsCron.bash</code> to make the script executable.</ol><li><p>Set up the cron job to aggregate the hourly readings needed for the fast data access OED does to the database when zoomed in on data. The site can choose how frequently to do this. If the site wants to see the latest meter data quickly then this should be done hourly. Note the update takes a modest amount of CPU and can delay when users see data. If preferred, the site could run the script daily just before running the daily updates. This would mean the new hourly data would only become visible after the day completes. However, sites generally do not have issues with doing this every hour so it is normally done.<ol><li>In the root OED directory do (this assumes the site updates every hour): <code>cp src/scripts/refreshHourlyReadingViewsCron.bash /etc/cron.hourly/refreshHourlyReadingViewsCron.bash</code><li>Edit /etc/cron.daily/refreshHourlyReadingViewsCron.bash to make the necessary modifications to the script. See the script for more detail but it should be the same as the daily script changes.<li>Do: <code>chmod +x /etc/cron.hourly/refreshHourlyReadingViewsCron.bash</code> to make the script executable.</ol><li><p>Set up the service so OED runs regularly on the server. There is a chance that the server version of Unix requires a modification of these steps. These steps should work on a Red Hat/Centos Unix. The "User" needed to set below is the one assigned to OED. It is the one logged into the terminal before becoming superuser/root and (hopefully not) the superuser/root.<ol><li>In the root OED directory do: <code>cp src/scripts/oed.service /etc/systemd/system/oed.service</code><li>Edit /etc/systemd/system/oed.service to make the necessary modifications to the script. See the script for more detail.<li>Do: <code>systemctl enable oed.service</code> to make the service start on server boot.<li>Assuming the site wants to start OED at this time do: <code>systemctl start oed.service</code>. Stop the app at any time by doing: <code>systemctl stop oed.service</code> but note it will restart on the next reboot unless this service is disabled with: <code>systemctl disable oed.service</code>.<li>To check the status of the OED service do: <code>systemctl list-units --type=service | grep -i oed</code>. Note that OED needs to reinstall/restart whenever the service is started again so it will take a little while from the time this lists the service as loaded and active running until it is ready to serve up web pages.<li>If one wants to check this is all set up correctly then restart the server and check it is still serving up web pages (as described above).</ol><li>Sometimes one wants to see the output of OED when it is running as a service. This can be useful during the install to see why OED did not come up. Do this by:<ol><li>Get the container ID by using: <code>docker ps -a</code>. The CONTAINER ID will be the one with the IMAGE of ...oed_web (where there may be some name in the ...) for the install/web output and IMAGE of ...oed_database for any database output.<li><code>docker logs &lt;CONTAINER ID&gt; | more</code> where &lt;CONTAINER ID&gt; is replaced with the value from the previous step.</ol></ol><h1>OED upgrades</h1><p>The OED project is regularly improving the code and releasing new versions of OED. To get the latest features, a site will probably want to upgrade OED over time. Information on officially released and tagged versions is given on the <a href="https://github.com/OpenEnergyDashboard/OED/releases" rel="noopener noreferrer">OED GitHub release page</a>. If a newer version is desired then upgrade to it. Consult the directions on the <a href="../adminUpgrading/">OED Upgrading page</a>.<h1>Admin setup</h1><p>The designated admin can use the login created above to set the desired features and items of OED. The following may be desired where the links can be used to get more information:<ul><li><a href="../adminPreferences/">Site preferences</a>. Allows for setting of the site name, default actions on the graphic pages, creating other users, and certain limits among other things.<li><a href="../adminDataAcquisition/">data acquisition</a>. Discusses getting meter data into OED so the site can display data.<li><a href="../adminOedUnits/">Standard units and conversions</a>. Discusses the units and conversions provided by OED and making more of them visible to the user.<li><a href="../adminUser/">Users</a>. To create additional user logins and manage them.<li><a href="../admin/">Admin features</a>. Discusses the range of actions that admins can take and the related documentation pages. There are many OED features other than the ones linked directly above.</ul><h1>Other information</h1><p>Though less likely, one may want to consult:<ul><li><a href="https://openenergydashboard.org/developer/environment/">Environment variable</a> page about all the OED environment variables.<li><a href="https://openenergydashboard.org/developer/npm/">NPM script</a> page about the available scripts to support the OED setup.</ul><p>It is rare that the node/npm installation is not okay in a production environment. The OED installation detects if the node install already happened (because there is an up-to-date node_modules directory in the root OED directory) and skips doing it again to save time. However, a site can force OED to do the node install by going to the root OED directory and deleting the node_modules directory with: <code>rm -rf node_modules/</code>. Make sure OED is not running (see stopping the service above) before doing this since it will break the application. Redoing the OED install with <code>docker compose up</code> will recreate this directory.</div></div></article></div></div><div id="up-to-top" class="row"><div class="small-12 columns" style="text-align: right;"> <a class="iconfont" href="#top-of-page">&#xf108;</a></div></div><footer id="footer-content" class="bg-grau"><div id="footer"><div class="row"> <noscript><div class="alert-box warning "><p>Some aspect of this site will not work and others will work better if you enable JavaScript.</div></noscript></div><div class="row"><div class="medium-6 large-5 columns"><h5 class="shadow-black">About This Site</h5><p class="shadow-black"> The OED dashboard allows organization to acquire, archive, analyze and display energy/resource usage. <a href="https://openenergydashboard.org/features/">More ›</a></div><div class="small-6 medium-3 large-3 large-offset-1 columns"><h5 class="shadow-black">Services</h5><ul class="no-bullet shadow-black"><li > <a href="https://openenergydashboard.org/" title=""></a><li > <a href="https://openenergydashboard.org/contact/" title="Contact">Contact</a><li > <a href="https://openenergydashboard.org/sitemap.xml" title="Sitemap for Google Webmaster Tools">sitemap.xml</a></ul></div><div class="small-6 medium-3 large-3 columns"><ul class="no-bullet shadow-black"></ul></div></div></div><div id="subfooter"><nav class="row"><section id="subfooter-left" class="small-12 medium-6 columns credits"><p>Created by the OED team using <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> based on <a href="https://phlow.github.io/feeling-responsive/">Feeling Responsive</a>. This page is part of the Open Energy Dashboard and is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed with this file, you can obtain one at <a href="https://www.mozilla.org/en-US/MPL/2.0/" rel="nofollow">https://www.mozilla.org/en-US/MPL/2.0/</a>.</section><section id="subfooter-right" class="small-12 medium-6 columns"><ul class="inline-list social-icons"><li><a href="https://github.com/OpenEnergyDashboard/OED" target="_blank" class="icon-github" title="Code other repos..."></a></ul></section></nav></div></footer><script src="https://openenergydashboard.org/assets/js/javascript.min.js"></script>
