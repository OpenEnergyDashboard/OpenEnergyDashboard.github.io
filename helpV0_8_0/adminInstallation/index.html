<!doctype html><html class="no-js" lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Installation Directions Doc</title><link rel="stylesheet" type="text/css" href="https://openenergydashboard.org/assets/css/styles_feeling_responsive.css"> <script src="https://openenergydashboard.org/assets/js/modernizr.min.js"></script> <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script> <script> WebFont.load({ google: { families: [ 'Lato:400,700,400italic:latin', 'Volkhov::latin' ] } }); </script> <noscript><link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7CVolkhov' rel='stylesheet' type='text/css'> </noscript><meta name="description" content="Version V0.8.0 The latest version of this page is V1.0.0. Documentation overview Admin documentation Information Overview Site Management Group Map Management Map Viewing Meter Viewing Site Settings User Data Acquisition CSV Import Data Acquisition MAMAC Meter Import Reading Import Site Installation Production Install Output Installation Directions Upgrades User documentation User help Documentation versions for this page V1.0.0 V0.8.0 (current page) V0.7.0 These features are only available to select people who oversee the OED site (called admins) so this information is not usually of interest to a general user. This describes the installation of an OED site for production use. If you are a developer, you likely want to follow the directions on the getting started page. Requirements OED uses Unix, including Linux, features to work. Mac-OS X is based on Unix and Docker can be installed directly as an application. Windows OS is not based on Unix so other steps are necessary. Given that Windows 10+ is generally needed to install OED and the fact that most systems run at least Windows 10, these directions assume your system is at that level of Windows (and use the OS name Windows 10). If you have Windows 10 Professional, Enterprise or Education, you should be able to directly install Docker via the Hyper-V though it may need to be enabled (this has not been tested by OED). If you have Windows 10 Home then you can use WSL 2 to enable Linux and then install Docker. Once you have Docker installed and working, you can follow the direction given here since they only depend on Docker/docker compose. The developer getting started page has details on WSL and Docker installation. OED is installed using the Docker containerization tool. This allows it to be segregated from the rest of the system, and makes updates easier to perform, since the dependencies are all taken care of through the container definitions. Under Docker, OED is installed and administered using the docker compose command. (Note more recent versions of Docker have the docker compose command so you no longer need docker-compose. If your Docker does not support this (likely see an error with docker compose of &quot;docker: &#39;compose&#39; is not a docker command.&quot;) then you need to install docker-compose and replace all the docker compose commands with docker-compose.) You will need Docker version 18.06 CE or higher but that should not be an issue if you have any reasonably up-to-date version. Some versions of Linux already have Docker or it can be installed. Docker for MacOS is an app that can easily be installed. For Windows 10 Home you can see the link on the WSL page given in the previous step. General Docker installation information is available from Docker. It is assumed that your server is set up to respond to web requests (port 80) and that port 3000 is allowed (unless you change the default OED port). It is also assumed the server can access the internet for the installation. These directions assume someone with root access to the server where OED is being installed and a working knowledge of doing Unix shell commands including editing text files. This is generally someone within the IT department of your organization. This guide requires that you enter some commands into an operating system shell, or terminal. On Windows, this is the terminal that connects to the Linux running under WSL. On MacOS, you can use Terminal.app (the default), iTerm2, or any other terminal program. On Linux, your distribution will provide a terminal; it can generally be opened with Ctrl+Shift+T or by searching for &quot;Terminal&quot; in your application menu. Installation Follow these steps to install a production (OED site for you institution) site: Clone the desired OED code from Github. Note if you leave off directory in the next step then the OED code will be placed in the current directory in the subdirectory OED. If you use &quot;.&quot; for the directory (just a period without the quotes) then the OED software will be placed directly into the current directory without a subdirectory. You can place the OED software anywhere you want but be sure to be in the desired directory before you begin the clone. If you want a specific released version of OED (this is most common) then do: git clone --branch &amp;lt;tag_name&amp;gt; https://github.com/OpenEnergyDashboard/OED.git [directory]. You can find the officially released and tagged versions at the OED GitHub release page. In general, you should take the latest release (at the top of the page). Note that the clone will not include git history (with detached head) but that should not be needed in a production environment. For example, to get release v0.7.0 in the subdirectory OED of the current directory do: git clone --branch v0.7.0 https://github.com/OpenEnergyDashboard/OED.git. After this you should see the directory OED where you did the clone. If you want the latest version from development then do: git clone https://github.com/OpenEnergyDashboard/OED.git [directory]. Note this will likely be code that has yet gone through complete testing as done for an official release version but will have the latest OED code base. cd into the directory that has the cloned version of OED. This is known as the root directory of OED. It has a README.md file and others. What follows assumes you are in the root directory of OED (as is the default when you clone). Edit docker-compose.yml. Note that for values with an = you should not put spaces before or after the equal sign as is shown in the sample value. The edits are: POSTGRES_PASSWORD (under services: -&amp;gt; datebase: -&amp;gt; environment:) to a site specific password instead of the pleaseChange that is provided. Keep it secret but you should never need to know this value unless you want to access the PostgreSQL database outside of the docker container. It will be: - POSTGRES_PASSWORD=whateverPasswordYouChoose OED_PRODUCTION (under services: -&amp;gt; web: -&amp;gt; environment:) to yes so it becomes: - OED_PRODUCTION=yes. OED_TOKEN_SECRET (under services: -&amp;gt; web: -&amp;gt; environment:) to a random value instead of the ? that is provided. Keep it secret but you should never need to know this value. It will be: - OED_TOKEN_SECRET=whateverTokenYouChoose The port (in services: -&amp;gt; web: -&amp;gt; ports:) to a mapping from host to container; e.g., to host on your computer&#39;s port 80, set it to 80:3000. This assumes you want to serve OED up on the standard web port. There are multiple lines here and some are commented out (begin with #). Before you edit it should look like: ports: - &quot;3000:3000&quot; # Should be commented out if you uncomment 80:3000 below. - &quot;9229:9229&quot; # Debug port, should be commented out for production # For production you might want something like: # - &quot;80:3000&quot; # and comment out the debug port and 3000:3000 line above If you want to have standard web requests (port 80) serve up OED then edit to look like (you comment out the debug port because it is not normally used in production): ports: # - &quot;3000:3000&quot; # Should be commented out if you uncomment 80:3000 below. # - &quot;9229:9229&quot; # Debug port, should be commented out for production # For production you might want something like: - &quot;80:3000&quot; # and comment out the debug port and 3000:3000 line above It is possible to use a different port. For example, if you leave the line - &quot;3000:3000&quot; uncommented and comment out - &quot;9229:9229&quot; then OED will server up on port 3000 (where you leave the - &quot;80:3000&quot; line commented out). OED_SITE_READING_RATE (under services: -&amp;gt; web: -&amp;gt; environment:) might need to be updated. This represents the typical rate that meters at your site provide data. This impacts when OED switches from daily to hourly to original meter data when doing line graphics. The default value is 00:15:00 meaning the meter data is expected every 15 minutes. If the value is roughly right then there should be no issues. Note you do not change OED_TEST_SITE_READING_RATE as that is used internally for the automated tests in OED. More information is available on the help pages. Later in these directions, it is suggested you set up a cron job to send an email to someone each day with any issues the OED installation encountered. For this to work, OED needs to have access to a mail system (SMTP server) to send the mail. To do this you need to set these environment values under services: -&amp;gt; web: -&amp;gt; environment: OED_MAIL_METHOD gives the way email is sent (SMTP). As the comment says this can be secure-smtp to use your SMTP server or none if you are not going to have OED send mail alerts. OED only supports sending mail via secure channels. Note that the SMTP listed here does not have to relate to the mail recipient. In the end, this usually becomes OED_MAIL_METHOD=secure-smtp. OED_MAIL_SMTP gives the web address of the SMTP server you are using. For example, it could be OED_MAIL_SMTP=smtp.example.com where example.com would become the domain for your organization or you could use OED_MAIL_SMTP=smtp.gmail.com for Google Mail. OED_MAIL_SMTP_PORT gives the port number of the SMTP server you are using. For example, it is often OED_MAIL_SMTP_PORT=465 for the standard SSL connection port. OED_MAIL_IDENT gives the user name on the SMTP server where the mail will be sent. Replace someone@example.com with your user name email. OED_MAIL_CREDENTIAL gives the password for the SMTP user in OED_MAIL_IDENT. Replace credential with that password. Note this setup cannot accommodate two factor authentication (2FA) unless you have access to a token for the credential (an app password for mail for Google has been tested and it works). OED_MAIL_FROM give the email address that the mail will be from. This is often the same as the OED_MAIL_IDENT so it might be OED_MAIL_FROM=mydomain@example.com where you use the desired email address. OED_MAIL_TO gives the email address of who will get the emails. Replace someone@example.com with the desired email. It can be the same as the SMTP email above or something different. OED_MAIL_ORG gives the organization name that will be part of the subject of the email sent. This may be important in recognizing the email, esp. if the person receiving it gets email from multiple OED sites (not common). Replace My Organization Name with whatever name you want. For the remaining steps you need to be the superuser/root to have sufficient permission to modify system files. On some OS setups you can do the install step (next) without being the superuser but it is generally safer to not to try. Make sure you are in the root OED directory (where the README.md file is located). Install OED on the server by doing docker compose up. (On older versions of Docker you must do docker-compose up.) This will get all the needed software including Postgres, all node packages and then installs all the needed software. This can take from a minute to 10+ minutes depending on the speed of your server. You will see a lot of output about installing the database (Postgres), getting needed packages (this can take a while so you may not see output for a while normally happening right after the &quot; database system is ready to accept connections&quot; output line) and starting up the web system. When you see the lines: oed-web-1 | &amp;lt;s&amp;gt; [webpack.Progress] 100% oed-web-1 | oed-web-1 | ℹ ｢atl｣: Time: 24033ms then OED should be ready to accept web requests, where the actual number of hidden modules will likely be different. Note is says is is listening on port 3000 since that is what OED listens on but the ports: changes you made above mean the web requests to port 80 (or whatever you chose) will be sent on to port 3000 for OED. If there was an error in the output then OED might not be running properly. Please contact the OED project if you have questions where sending the terminal text is generally very helpful. If you quickly get the error Invalid interpolation format for &quot;command&quot; option in service &quot;web&quot;: &quot;${install_args:-}&quot; then it is likely you are running an older version of docker-compose (less than version 2). You can fix this error by editing the docker-compose.yml file (as you did above). At the end of the file you will see (Note OED v0.7.0 and earlier does not have the last three lines to deal with older versions of docker compose so you will need to add them during your edits. It also has the reverse proxy line comment that has since been removed.): # Lets docker-compose up work right # If environment variable install_args is not set the it becomes blank without warning user. command: [&quot;bash&quot;, &quot;./src/scripts/installOED.sh&quot;, &quot;${install_args:-}&quot;] # Use this if you are using a docker-compose that is earlier than version 2 and comment out the one above. # command: [&quot;bash&quot;, &quot;./src/scripts/installOED.sh&quot;] Edit this to be: # Lets docker-compose up work right # If environment variable install_args is not set the it becomes blank without warning user. # command: [&quot;bash&quot;, &quot;./src/scripts/installOED.sh&quot;, &quot;${install_args:-}&quot;] # Use this if you are using a docker-compose that is earlier than version 2 and comment out the one above. command: [&quot;bash&quot;, &quot;./src/scripts/installOED.sh&quot;] If you redo the docker compose up then you should now get the expected output described above. The typical output of the install is available. You can now use a web browser to check that OED is properly serving up web pages. Use the web address oed.myinstition.org where you replace oed.myinstition.org with the name of the server where you installed OED. If all is working properly you will see the main OED page (see Graph Type help page for an image of what it will look like). You won&#39;t be able to graph any data until you have OED acquire meter data. If you did not do the mapping of 80:3000 above, then OED would be reachable at oed.myinstition.org:3000. You now need to create an admin user so you can log into OED on the website. To do this you will need a second terminal where you go to the root OED directory and are a superuser/root (as you have been). This is done so you don&#39;t have to shut down OED to add the user. Run the script with: docker compose run web npm run createUser. The code will prompt you to enter an email address and password: # docker compose run web npm run createUser Starting checkoed_database_1 ... done &gt; Open-Energy-Dashboard@0.6.0 createUser &gt; node ./src/server/services/user/createUser.js Email of user to create: someEmail@yourInstitution.org Password: passwordYouChoose [INFO@2021-10-13T21:40:31.853Z] User created or already exists where you replace someEmail@yourInstitution.org with any email (it does not have to be an active one) and passwordYouChoose with the password you want to use with this email to login to OED (passwords must be at least 8 characters long). It is important to remember this email &amp; password so you have access to OED admin features on the web pages. You can run the command docker compose run web npm run editUser to change the password if you forget it or you can create a new user. Note an OED admin user can create more users on the site so this is normally a one-time step. Note that OED echos what you type so this information will be in the terminal. You shouldn&#39;t need this terminal any more so you can close it to hide the information or usually type clear to remove it from what is shown in the terminal. You should now log in to make sure this account works. Logging in directions are available but basically you click the &quot;Log in&quot; button in the top, right of the OED website and then enter the information. Shut down OED. You will soon be setting up OED to run as a service so you want to stop the one running in the terminal. In the terminal where you started OED (with docker compose up), do &quot;^c&quot; to shut down OED. Be a little patient since doing a second &quot;^c&quot; will cause a rapid stop of docker without the normal cleanup. In the following steps you need to know the root directory of OED. In the terminal where you are in the OED root directory do: pwd and the output will tell you the directory path. Set up the daily cron job to email the OED admin with any issues that occurred in the past day. You are not required to do this but it is a very good idea. It gives someone a daily email of any issue so they are not missed. See above about needed values in docker-compose.yml to support sending emails. In the root OED directory do: cp src/scripts/sendLogEmailCron.bash /etc/cron.daily/sendLogEmailCron.bash Edit /etc/cron.daily/sendLogEmailCron.bash to make the necessary modifications to the script. See the script for more detail. Do: chmod +x /etc/cron.daily/sendLogEmailCron.bash to make the script executable. Set up the daily cron job to aggregate the daily readings needed for the fast data access OED does to the database. In the root OED directory do: cp src/scripts/refreshReadingViewsCron.bash /etc/cron.daily/refreshReadingViewsCron.bash Edit /etc/cron.daily/refreshReadingViewsCron.bash to make the necessary modifications to the script. See the script for more detail. Do: chmod +x /etc/cron.daily/refreshReadingViewsCron.bash to make the script executable. Set up the cron job to aggregate the hourly readings needed for the fast data access OED does to the database when zoomed in on data. The site can choose how frequently to do this. If you want to see the latest meter data quickly then this should be done hourly. Note the update takes a modest amount of CPU and can delay when users see data. If you prefer, you could run the script daily just before running the daily updates. This would mean the new hourly data would only become visible after the day completes. In the root OED directory do (this assumes you do the update every hour): cp src/scripts/refreshHourlyReadingViewsCron.bash /etc/cron.hourly/refreshHourlyReadingViewsCron.bash Edit /etc/cron.daily/refreshHourlyReadingViewsCron.bash to make the necessary modifications to the script. See the script for more detail but it should be the same as the daily script changes. Do: chmod +x /etc/cron.hourly/refreshHourlyReadingViewsCron.bash to make the script executable. Set up the service so OED runs regularly on your system. There is a chance that your version of Unix requires a modification of these steps. These steps should work on a Red Hat/Centos Unix. The &quot;User&quot; you need to set below is the one assigned to OED, the one you logged in as before becoming superuser/root or (hopefully not) the superuser/root. In the root OED directory do: cp src/scripts/oed.service /etc/systemd/system/oed.service Edit /etc/systemd/system/oed.service to make the necessary modifications to the script. See the script for more detail. Do: systemctl enable oed.service to make the service start on server boot. Assuming you want to start OED at this time do: systemctl start oed.service. Stop the app at any time by doing: systemctl stop oed.service but note it will restart on the next reboot unless you disable this service with: systemctl disable oed.service. To check the status of the OED service do: systemctl list-units --type=service | grep -i oed. Note that OED needs to reinstall/restart when you start the service again so it will take a little while from the time this lists the service as loaded and active running until it is ready to serve up web pages. If you want to check this is all set up correctly then restart the server and check it is still serving up web pages (as described above). Sometimes you want to see the output of OED when it is running as a service. This can be useful during the install if you want to see why OED did not come up. You do this by: Get the container ID by using: docker ps -a. The CONTAINER ID will be the one with the IMAGE of ...oed_web (where there may be some name in the ...) for the install/web output and IMAGE of ...oed_database for any database output. docker logs &amp;lt;CONTAINER ID&amp;gt; | more where you replace &amp;lt;CONTAINER ID&amp;gt; with the one you want from the previous step. You will want to get meter data into OED so the site can display data. See the data acquisition page for more information on doing this. OED upgrades The OED project is regularly improving the code and releasing new versions of OED. To get the latest features, you will probably want to upgrade OED over time. Information on officially released and tagged versions is given on the OED GitHub release page. If you see a newer version that you want to upgrade to then consult the directions on the OED Upgrading page. Other information Though less likely, you may want to consult: Environment variable page about all the OED environment variables. NPM script page about the available scripts to support the OED setup. It is rare that the node/npm installation is not okay in a production environment. The OED installation detects if the node install already happened (because there is a node_modules directory in the root OED directory) and skips doing it again to save time. However you can force OED to do the node install by going to the root OED directory and deleting the node_modules directory with: rm -rf node_modules/. Make sure OED is not running (see stopping the service above) before you do this since it will break the application. Redoing the OED install with docker compose up will recreate this directory."><meta name="google-site-verification" content="Vk0IOJ2jwG_qEoG7fuEXYqv0m2rLa8P778Fi_GrsgEQ"><meta name="msvalidate.01" content="0FB4C028ABCF07C908C54386ABD2D97F" ><link rel="canonical" href="https://openenergydashboard.org/helpV0_8_0/adminInstallation/"><meta property="og:title" content="Installation Directions Doc"><meta property="og:description" content="Version V0.8.0 The latest version of this page is V1.0.0. Documentation overview Admin documentation Information Overview Site Management Group Map Management Map Viewing Meter Viewing Site Settings User Data Acquisition CSV Import Data Acquisition MAMAC Meter Import Reading Import Site Installation Production Install Output Installation Directions Upgrades User documentation User help Documentation versions for this page V1.0.0 V0.8.0 (current page) V0.7.0 These features are only available to select people who oversee the OED site (called admins) so this information is not usually of interest to a general user. This describes the installation of an OED site for production use. If you are a developer, you likely want to follow the directions on the getting started page. Requirements OED uses Unix, including Linux, features to work. Mac-OS X is based on Unix and Docker can be installed directly as an application. Windows OS is not based on Unix so other steps are necessary. Given that Windows 10+ is generally needed to install OED and the fact that most systems run at least Windows 10, these directions assume your system is at that level of Windows (and use the OS name Windows 10). If you have Windows 10 Professional, Enterprise or Education, you should be able to directly install Docker via the Hyper-V though it may need to be enabled (this has not been tested by OED). If you have Windows 10 Home then you can use WSL 2 to enable Linux and then install Docker. Once you have Docker installed and working, you can follow the direction given here since they only depend on Docker/docker compose. The developer getting started page has details on WSL and Docker installation. OED is installed using the Docker containerization tool. This allows it to be segregated from the rest of the system, and makes updates easier to perform, since the dependencies are all taken care of through the container definitions. Under Docker, OED is installed and administered using the docker compose command. (Note more recent versions of Docker have the docker compose command so you no longer need docker-compose. If your Docker does not support this (likely see an error with docker compose of &quot;docker: &#39;compose&#39; is not a docker command.&quot;) then you need to install docker-compose and replace all the docker compose commands with docker-compose.) You will need Docker version 18.06 CE or higher but that should not be an issue if you have any reasonably up-to-date version. Some versions of Linux already have Docker or it can be installed. Docker for MacOS is an app that can easily be installed. For Windows 10 Home you can see the link on the WSL page given in the previous step. General Docker installation information is available from Docker. It is assumed that your server is set up to respond to web requests (port 80) and that port 3000 is allowed (unless you change the default OED port). It is also assumed the server can access the internet for the installation. These directions assume someone with root access to the server where OED is being installed and a working knowledge of doing Unix shell commands including editing text files. This is generally someone within the IT department of your organization. This guide requires that you enter some commands into an operating system shell, or terminal. On Windows, this is the terminal that connects to the Linux running under WSL. On MacOS, you can use Terminal.app (the default), iTerm2, or any other terminal program. On Linux, your distribution will provide a terminal; it can generally be opened with Ctrl+Shift+T or by searching for &quot;Terminal&quot; in your application menu. Installation Follow these steps to install a production (OED site for you institution) site: Clone the desired OED code from Github. Note if you leave off directory in the next step then the OED code will be placed in the current directory in the subdirectory OED. If you use &quot;.&quot; for the directory (just a period without the quotes) then the OED software will be placed directly into the current directory without a subdirectory. You can place the OED software anywhere you want but be sure to be in the desired directory before you begin the clone. If you want a specific released version of OED (this is most common) then do: git clone --branch &amp;lt;tag_name&amp;gt; https://github.com/OpenEnergyDashboard/OED.git [directory]. You can find the officially released and tagged versions at the OED GitHub release page. In general, you should take the latest release (at the top of the page). Note that the clone will not include git history (with detached head) but that should not be needed in a production environment. For example, to get release v0.7.0 in the subdirectory OED of the current directory do: git clone --branch v0.7.0 https://github.com/OpenEnergyDashboard/OED.git. After this you should see the directory OED where you did the clone. If you want the latest version from development then do: git clone https://github.com/OpenEnergyDashboard/OED.git [directory]. Note this will likely be code that has yet gone through complete testing as done for an official release version but will have the latest OED code base. cd into the directory that has the cloned version of OED. This is known as the root directory of OED. It has a README.md file and others. What follows assumes you are in the root directory of OED (as is the default when you clone). Edit docker-compose.yml. Note that for values with an = you should not put spaces before or after the equal sign as is shown in the sample value. The edits are: POSTGRES_PASSWORD (under services: -&amp;gt; datebase: -&amp;gt; environment:) to a site specific password instead of the pleaseChange that is provided. Keep it secret but you should never need to know this value unless you want to access the PostgreSQL database outside of the docker container. It will be: - POSTGRES_PASSWORD=whateverPasswordYouChoose OED_PRODUCTION (under services: -&amp;gt; web: -&amp;gt; environment:) to yes so it becomes: - OED_PRODUCTION=yes. OED_TOKEN_SECRET (under services: -&amp;gt; web: -&amp;gt; environment:) to a random value instead of the ? that is provided. Keep it secret but you should never need to know this value. It will be: - OED_TOKEN_SECRET=whateverTokenYouChoose The port (in services: -&amp;gt; web: -&amp;gt; ports:) to a mapping from host to container; e.g., to host on your computer&#39;s port 80, set it to 80:3000. This assumes you want to serve OED up on the standard web port. There are multiple lines here and some are commented out (begin with #). Before you edit it should look like: ports: - &quot;3000:3000&quot; # Should be commented out if you uncomment 80:3000 below. - &quot;9229:9229&quot; # Debug port, should be commented out for production # For production you might want something like: # - &quot;80:3000&quot; # and comment out the debug port and 3000:3000 line above If you want to have standard web requests (port 80) serve up OED then edit to look like (you comment out the debug port because it is not normally used in production): ports: # - &quot;3000:3000&quot; # Should be commented out if you uncomment 80:3000 below. # - &quot;9229:9229&quot; # Debug port, should be commented out for production # For production you might want something like: - &quot;80:3000&quot; # and comment out the debug port and 3000:3000 line above It is possible to use a different port. For example, if you leave the line - &quot;3000:3000&quot; uncommented and comment out - &quot;9229:9229&quot; then OED will server up on port 3000 (where you leave the - &quot;80:3000&quot; line commented out). OED_SITE_READING_RATE (under services: -&amp;gt; web: -&amp;gt; environment:) might need to be updated. This represents the typical rate that meters at your site provide data. This impacts when OED switches from daily to hourly to original meter data when doing line graphics. The default value is 00:15:00 meaning the meter data is expected every 15 minutes. If the value is roughly right then there should be no issues. Note you do not change OED_TEST_SITE_READING_RATE as that is used internally for the automated tests in OED. More information is available on the help pages. Later in these directions, it is suggested you set up a cron job to send an email to someone each day with any issues the OED installation encountered. For this to work, OED needs to have access to a mail system (SMTP server) to send the mail. To do this you need to set these environment values under services: -&amp;gt; web: -&amp;gt; environment: OED_MAIL_METHOD gives the way email is sent (SMTP). As the comment says this can be secure-smtp to use your SMTP server or none if you are not going to have OED send mail alerts. OED only supports sending mail via secure channels. Note that the SMTP listed here does not have to relate to the mail recipient. In the end, this usually becomes OED_MAIL_METHOD=secure-smtp. OED_MAIL_SMTP gives the web address of the SMTP server you are using. For example, it could be OED_MAIL_SMTP=smtp.example.com where example.com would become the domain for your organization or you could use OED_MAIL_SMTP=smtp.gmail.com for Google Mail. OED_MAIL_SMTP_PORT gives the port number of the SMTP server you are using. For example, it is often OED_MAIL_SMTP_PORT=465 for the standard SSL connection port. OED_MAIL_IDENT gives the user name on the SMTP server where the mail will be sent. Replace someone@example.com with your user name email. OED_MAIL_CREDENTIAL gives the password for the SMTP user in OED_MAIL_IDENT. Replace credential with that password. Note this setup cannot accommodate two factor authentication (2FA) unless you have access to a token for the credential (an app password for mail for Google has been tested and it works). OED_MAIL_FROM give the email address that the mail will be from. This is often the same as the OED_MAIL_IDENT so it might be OED_MAIL_FROM=mydomain@example.com where you use the desired email address. OED_MAIL_TO gives the email address of who will get the emails. Replace someone@example.com with the desired email. It can be the same as the SMTP email above or something different. OED_MAIL_ORG gives the organization name that will be part of the subject of the email sent. This may be important in recognizing the email, esp. if the person receiving it gets email from multiple OED sites (not common). Replace My Organization Name with whatever name you want. For the remaining steps you need to be the superuser/root to have sufficient permission to modify system files. On some OS setups you can do the install step (next) without being the superuser but it is generally safer to not to try. Make sure you are in the root OED directory (where the README.md file is located). Install OED on the server by doing docker compose up. (On older versions of Docker you must do docker-compose up.) This will get all the needed software including Postgres, all node packages and then installs all the needed software. This can take from a minute to 10+ minutes depending on the speed of your server. You will see a lot of output about installing the database (Postgres), getting needed packages (this can take a while so you may not see output for a while normally happening right after the &quot; database system is ready to accept connections&quot; output line) and starting up the web system. When you see the lines: oed-web-1 | &amp;lt;s&amp;gt; [webpack.Progress] 100% oed-web-1 | oed-web-1 | ℹ ｢atl｣: Time: 24033ms then OED should be ready to accept web requests, where the actual number of hidden modules will likely be different. Note is says is is listening on port 3000 since that is what OED listens on but the ports: changes you made above mean the web requests to port 80 (or whatever you chose) will be sent on to port 3000 for OED. If there was an error in the output then OED might not be running properly. Please contact the OED project if you have questions where sending the terminal text is generally very helpful. If you quickly get the error Invalid interpolation format for &quot;command&quot; option in service &quot;web&quot;: &quot;${install_args:-}&quot; then it is likely you are running an older version of docker-compose (less than version 2). You can fix this error by editing the docker-compose.yml file (as you did above). At the end of the file you will see (Note OED v0.7.0 and earlier does not have the last three lines to deal with older versions of docker compose so you will need to add them during your edits. It also has the reverse proxy line comment that has since been removed.): # Lets docker-compose up work right # If environment variable install_args is not set the it becomes blank without warning user. command: [&quot;bash&quot;, &quot;./src/scripts/installOED.sh&quot;, &quot;${install_args:-}&quot;] # Use this if you are using a docker-compose that is earlier than version 2 and comment out the one above. # command: [&quot;bash&quot;, &quot;./src/scripts/installOED.sh&quot;] Edit this to be: # Lets docker-compose up work right # If environment variable install_args is not set the it becomes blank without warning user. # command: [&quot;bash&quot;, &quot;./src/scripts/installOED.sh&quot;, &quot;${install_args:-}&quot;] # Use this if you are using a docker-compose that is earlier than version 2 and comment out the one above. command: [&quot;bash&quot;, &quot;./src/scripts/installOED.sh&quot;] If you redo the docker compose up then you should now get the expected output described above. The typical output of the install is available. You can now use a web browser to check that OED is properly serving up web pages. Use the web address oed.myinstition.org where you replace oed.myinstition.org with the name of the server where you installed OED. If all is working properly you will see the main OED page (see Graph Type help page for an image of what it will look like). You won&#39;t be able to graph any data until you have OED acquire meter data. If you did not do the mapping of 80:3000 above, then OED would be reachable at oed.myinstition.org:3000. You now need to create an admin user so you can log into OED on the website. To do this you will need a second terminal where you go to the root OED directory and are a superuser/root (as you have been). This is done so you don&#39;t have to shut down OED to add the user. Run the script with: docker compose run web npm run createUser. The code will prompt you to enter an email address and password: # docker compose run web npm run createUser Starting checkoed_database_1 ... done &gt; Open-Energy-Dashboard@0.6.0 createUser &gt; node ./src/server/services/user/createUser.js Email of user to create: someEmail@yourInstitution.org Password: passwordYouChoose [INFO@2021-10-13T21:40:31.853Z] User created or already exists where you replace someEmail@yourInstitution.org with any email (it does not have to be an active one) and passwordYouChoose with the password you want to use with this email to login to OED (passwords must be at least 8 characters long). It is important to remember this email &amp; password so you have access to OED admin features on the web pages. You can run the command docker compose run web npm run editUser to change the password if you forget it or you can create a new user. Note an OED admin user can create more users on the site so this is normally a one-time step. Note that OED echos what you type so this information will be in the terminal. You shouldn&#39;t need this terminal any more so you can close it to hide the information or usually type clear to remove it from what is shown in the terminal. You should now log in to make sure this account works. Logging in directions are available but basically you click the &quot;Log in&quot; button in the top, right of the OED website and then enter the information. Shut down OED. You will soon be setting up OED to run as a service so you want to stop the one running in the terminal. In the terminal where you started OED (with docker compose up), do &quot;^c&quot; to shut down OED. Be a little patient since doing a second &quot;^c&quot; will cause a rapid stop of docker without the normal cleanup. In the following steps you need to know the root directory of OED. In the terminal where you are in the OED root directory do: pwd and the output will tell you the directory path. Set up the daily cron job to email the OED admin with any issues that occurred in the past day. You are not required to do this but it is a very good idea. It gives someone a daily email of any issue so they are not missed. See above about needed values in docker-compose.yml to support sending emails. In the root OED directory do: cp src/scripts/sendLogEmailCron.bash /etc/cron.daily/sendLogEmailCron.bash Edit /etc/cron.daily/sendLogEmailCron.bash to make the necessary modifications to the script. See the script for more detail. Do: chmod +x /etc/cron.daily/sendLogEmailCron.bash to make the script executable. Set up the daily cron job to aggregate the daily readings needed for the fast data access OED does to the database. In the root OED directory do: cp src/scripts/refreshReadingViewsCron.bash /etc/cron.daily/refreshReadingViewsCron.bash Edit /etc/cron.daily/refreshReadingViewsCron.bash to make the necessary modifications to the script. See the script for more detail. Do: chmod +x /etc/cron.daily/refreshReadingViewsCron.bash to make the script executable. Set up the cron job to aggregate the hourly readings needed for the fast data access OED does to the database when zoomed in on data. The site can choose how frequently to do this. If you want to see the latest meter data quickly then this should be done hourly. Note the update takes a modest amount of CPU and can delay when users see data. If you prefer, you could run the script daily just before running the daily updates. This would mean the new hourly data would only become visible after the day completes. In the root OED directory do (this assumes you do the update every hour): cp src/scripts/refreshHourlyReadingViewsCron.bash /etc/cron.hourly/refreshHourlyReadingViewsCron.bash Edit /etc/cron.daily/refreshHourlyReadingViewsCron.bash to make the necessary modifications to the script. See the script for more detail but it should be the same as the daily script changes. Do: chmod +x /etc/cron.hourly/refreshHourlyReadingViewsCron.bash to make the script executable. Set up the service so OED runs regularly on your system. There is a chance that your version of Unix requires a modification of these steps. These steps should work on a Red Hat/Centos Unix. The &quot;User&quot; you need to set below is the one assigned to OED, the one you logged in as before becoming superuser/root or (hopefully not) the superuser/root. In the root OED directory do: cp src/scripts/oed.service /etc/systemd/system/oed.service Edit /etc/systemd/system/oed.service to make the necessary modifications to the script. See the script for more detail. Do: systemctl enable oed.service to make the service start on server boot. Assuming you want to start OED at this time do: systemctl start oed.service. Stop the app at any time by doing: systemctl stop oed.service but note it will restart on the next reboot unless you disable this service with: systemctl disable oed.service. To check the status of the OED service do: systemctl list-units --type=service | grep -i oed. Note that OED needs to reinstall/restart when you start the service again so it will take a little while from the time this lists the service as loaded and active running until it is ready to serve up web pages. If you want to check this is all set up correctly then restart the server and check it is still serving up web pages (as described above). Sometimes you want to see the output of OED when it is running as a service. This can be useful during the install if you want to see why OED did not come up. You do this by: Get the container ID by using: docker ps -a. The CONTAINER ID will be the one with the IMAGE of ...oed_web (where there may be some name in the ...) for the install/web output and IMAGE of ...oed_database for any database output. docker logs &amp;lt;CONTAINER ID&amp;gt; | more where you replace &amp;lt;CONTAINER ID&amp;gt; with the one you want from the previous step. You will want to get meter data into OED so the site can display data. See the data acquisition page for more information on doing this. OED upgrades The OED project is regularly improving the code and releasing new versions of OED. To get the latest features, you will probably want to upgrade OED over time. Information on officially released and tagged versions is given on the OED GitHub release page. If you see a newer version that you want to upgrade to then consult the directions on the OED Upgrading page. Other information Though less likely, you may want to consult: Environment variable page about all the OED environment variables. NPM script page about the available scripts to support the OED setup. It is rare that the node/npm installation is not okay in a production environment. The OED installation detects if the node install already happened (because there is a node_modules directory in the root OED directory) and skips doing it again to save time. However you can force OED to do the node install by going to the root OED directory and deleting the node_modules directory with: rm -rf node_modules/. Make sure OED is not running (see stopping the service above) before you do this since it will break the application. Redoing the OED install with docker compose up will recreate this directory."><meta property="og:url" content="https://openenergydashboard.org/helpV0_8_0/adminInstallation/"><meta property="og:locale" content="en_EN"><meta property="og:type" content="website"><meta property="og:site_name" content="Open Energy Dashboard"><link rel="icon" sizes="32x32" href="https://openenergydashboard.org/assets/img/OEDIcon22x32.png"><link rel="icon" sizes="192x192" href="https://openenergydashboard.org/assets/img/OEDIcon192x274.png"><body id="top-of-page" class="page-fullwidth"><div id="navigation" class="sticky"><nav class="top-bar" role="navigation" data-topbar data-options="scrolltop: false"><ul class="title-area"><li class="name"><h1 class="hide-for-large-up"><a href="https://openenergydashboard.org/" class="icon-tree"> Open Energy Dashboard</a></h1><li class="toggle-topbar toggle-topbar-click menu-icon"><a><span>Nav</span></a></ul><section class="top-bar-section"><ul class="left"><li><a href="https://openenergydashboard.org/">home</a><li class="divider"><li class="has-dropdown"> <a href="https://openenergydashboard.org/features/">features</a><ul class="dropdown"><li><a href="https://openenergydashboard.org/features/">features by type</a><li><a href="https://openenergydashboard.org/useAcademic/">features by academic use</a></ul><li class="divider"><li class="has-dropdown"> <a href="https://openenergydashboard.org/helpV1_0_0/user/">Documentation</a><ul class="dropdown"><li><a href="https://openenergydashboard.org/helpV1_0_0/user/">oed version 1.0.0</a><li><a href="https://openenergydashboard.org/helpV0_8_0/user/">oed version 0.8.0</a><li><a href="https://openenergydashboard.org/helpV0_7_0/user/">oed version 0.7.0</a><li><a href="https://openenergydashboard.org/helpV0_6_0/user/">oed version 0.6.0</a></ul><li class="divider"><li><a href="https://openenergydashboard.org/use/">Adopting</a><li class="divider"><li class="has-dropdown"> <a href="https://openenergydashboard.org/news/">info</a><ul class="dropdown"><li><a href="https://openenergydashboard.org/news/">news</a><li><a href="https://openenergydashboard.org/principles/">project principles</a><li><a href="https://openenergydashboard.org/free/">free &amp; maintained</a><li><a href="https://openenergydashboard.org/mission/">mission</a><li><a href="https://openenergydashboard.org/why/">why exists</a><li><a href="https://openenergydashboard.org/projectInfo/">project information pages &amp; license</a><li><a href="https://openenergydashboard.org/name/">why OED name, logo &amp; some history</a></ul><li class="divider"></ul><ul class="right"><li class="divider"><li><a href="https://openenergydashboard.org/search/">Search</a><li class="divider"><li><a href="https://openenergydashboard.org/contact/">Contact</a><li class="divider"><li><a href="https://openenergydashboard.org/developer/developer/">developer docs</a><li class="divider"><li class="has-dropdown"> <a href="https://openenergydashboard.org/involved/">get involved</a><ul class="dropdown"><li><a href="https://openenergydashboard.org/internship/">becoming a developer</a><li><a href="https://openenergydashboard.org/studentExperience/">student experience</a></ul></ul></section></nav></div><div id="masthead-no-image-header"><div class="row"><div class="small-6 small-centered columns"> <a id="logo" title="Open Energy Dashboard – A Free, Open Source Energy/Resource Dashboard"> <img src="https://openenergydashboard.org/assets/img/logoHelp.png" alt="Open Energy Dashboard – A Free, Open Source Energy/Resource Dashboard"> </a></div></div></div><nav class="breadcrumbs" role="menubar" aria-label="breadcrumbs"> <a href="https://openenergydashboard.org/">Start</a> <a href="https://openenergydashboard.org/helpV0_8_0/">helpV0_8_0</a> <a class="current">Installation Directions</a></nav><div class="row t15"><div class="medium-12 columns"><article><header><p class="subheadline">OED Documentation<h1>Installation Directions</h1></header><div class="row"><p>Version V0.8.0<div class="alert-box info "><p>The latest version of this page is <a href="https://openenergydashboard.org/helpV1_0_0/adminInstallation/">V1.0.0</a>.</div><div class="medium-4 medium-push-8 columns" markdown="1"><div class="panel radius" markdown="1"><div style="list-style: none;" class="side-nav"><h4><a href='../admin/'>Documentation overview</a></h4><div><h5>Admin documentation</h5><div style="padding-left: 1em;"><h6>Information</h6><div style="padding-left: 1em;"> <a href="https://openenergydashboard.org/helpV0_8_0/admin/">Overview</a></br></div></div><div style="padding-left: 1em;"><h6>Site Management</h6><div style="padding-left: 1em;"> <a href="https://openenergydashboard.org/helpV0_8_0/adminGroupViewing/">Group</a></br> <a href="https://openenergydashboard.org/helpV0_8_0/adminMap/">Map Management</a></br> <a href="https://openenergydashboard.org/helpV0_8_0/adminMapViewing/">Map Viewing</a></br> <a href="https://openenergydashboard.org/helpV0_8_0/adminMeterViewing/">Meter Viewing</a></br> <a href="https://openenergydashboard.org/helpV0_8_0/adminPreferences/">Site Settings</a></br> <a href="https://openenergydashboard.org/helpV0_8_0/adminUser/">User</a></br></div></div><div style="padding-left: 1em;"><h6>Data Acquisition</h6><div style="padding-left: 1em;"> <a href="https://openenergydashboard.org/helpV0_8_0/adminCsvImport/">CSV Import</a></br> <a href="https://openenergydashboard.org/helpV0_8_0/adminDataAcquisition/">Data Acquisition</a></br> <a href="https://openenergydashboard.org/helpV0_8_0/adminMamac/">MAMAC</a></br> <a href="https://openenergydashboard.org/helpV0_8_0/adminMetersImport/">Meter Import</a></br> <a href="https://openenergydashboard.org/helpV0_8_0/adminReadingsImport/">Reading Import</a></br></div></div><div style="padding-left: 1em;"><h6>Site Installation</h6><div style="padding-left: 1em;"> <a href="https://openenergydashboard.org/helpV0_8_0/adminInstallOutput/">Production Install Output</a></br> <a href="https://openenergydashboard.org/helpV0_8_0/adminInstallation/">Installation Directions</a></br> <a href="https://openenergydashboard.org/helpV0_8_0/adminUpgrading/">Upgrades</a></br></div></div><h5>User documentation</h5><div style="padding-left: 1em;"> <a href="https://openenergydashboard.org/helpV0_8_0/adminInstallation/../user/">User help</a></br></div><h5>Documentation versions for this page</h5><div style="padding-left: 1em;"> <a href="../../helpV1_0_0/adminInstallation/">V1.0.0</a></br> V0.8.0 (current page)</br> <a href="../../helpV0_7_0/adminInstallation/">V0.7.0</a></br></div></div></div></div></div><div class="medium-8 medium-pull-4 columns" markdown="1"><div class="alert-box info "><p>These features are only available to select people who oversee the OED site (called admins) so this information is not usually of interest to a general user.</div><p>This describes the installation of an OED site for production use. If you are a developer, you likely want to follow the directions on the <a href="https://openenergydashboard.org/developer/gettingStarted/">getting started</a> page.<h2>Requirements</h2><p>OED uses Unix, including Linux, features to work. Mac-OS X is based on Unix and Docker can be installed directly as an application. Windows OS is not based on Unix so other steps are necessary. Given that Windows 10+ is generally needed to install OED and the fact that most systems run at least Windows 10, these directions assume your system is at that level of Windows (and use the OS name Windows 10). If you have Windows 10 Professional, Enterprise or Education, you should be able to directly install Docker via the Hyper-V though it may need to be enabled (this has not been tested by OED). If you have Windows 10 Home then you can use WSL 2 to enable Linux and then install Docker. Once you have Docker installed and working, you can follow the direction given here since they only depend on Docker/docker compose. The <a href="https://openenergydashboard.org/developer/gettingStarted/">developer getting started page</a> has details on WSL and Docker installation.<p>OED is installed using the Docker containerization tool. This allows it to be segregated from the rest of the system, and makes updates easier to perform, since the dependencies are all taken care of through the container definitions. Under Docker, OED is installed and administered using the <code>docker compose</code> command. (Note more recent versions of Docker have the <code>docker compose</code> command so you no longer need <code>docker-compose</code>. If your Docker does not support this (likely see an error with <code>docker compose</code> of "docker: 'compose' is not a docker command.") then you need to install docker-compose and replace all the <code>docker compose</code> commands with <code>docker-compose</code>.) You will need Docker version 18.06 CE or higher but that should not be an issue if you have any reasonably up-to-date version. Some versions of Linux already have Docker or it can be installed. Docker for MacOS is an app that can easily be installed. For Windows 10 Home you can see the link on the WSL page given in the previous step. General Docker installation information is available from <a href="https://docs.docker.com/engine/install/" rel="nofollow">Docker</a>.<p>It is assumed that your server is set up to respond to web requests (port 80) and that port 3000 is allowed (unless you change the default OED port). It is also assumed the server can access the internet for the installation.<p>These directions assume someone with root access to the server where OED is being installed and a working knowledge of doing Unix shell commands including editing text files. This is generally someone within the IT department of your organization.<p>This guide requires that you enter some commands into an operating system shell, or terminal.<ul><li>On Windows, this is the terminal that connects to the Linux running under WSL.<li>On MacOS, you can use Terminal.app (the default), iTerm2, or any other terminal program.<li>On Linux, your distribution will provide a terminal; it can generally be opened with Ctrl+Shift+T or by searching for "Terminal" in your application menu.</ul><h2>Installation</h2><p>Follow these steps to install a production (OED site for you institution) site:<ol><li><p>Clone the desired OED code from Github. Note if you leave off <code>directory</code> in the next step then the OED code will be placed in the current directory in the subdirectory OED. If you use "." for the <code>directory</code> (just a period without the quotes) then the OED software will be placed directly into the current directory without a subdirectory. You can place the OED software anywhere you want but be sure to be in the desired directory before you begin the clone.<ul><li>If you want a specific released version of OED (this is most common) then do: <code>git clone --branch &lt;tag_name&gt; https://github.com/OpenEnergyDashboard/OED.git [directory]</code>. You can find the officially released and tagged versions at the <a href="https://github.com/OpenEnergyDashboard/OED/releases" rel="noopener noreferrer">OED GitHub release page</a>. In general, you should take the latest release (at the top of the page). Note that the clone will not include git history (with detached head) but that should not be needed in a production environment. For example, to get release v0.7.0 in the subdirectory OED of the current directory do: <code>git clone --branch v0.7.0 https://github.com/OpenEnergyDashboard/OED.git</code>. After this you should see the directory OED where you did the clone.<li>If you want the latest version from development then do: <code>git clone https://github.com/OpenEnergyDashboard/OED.git [directory]</code>. Note this will likely be code that has yet gone through complete testing as done for an official release version but will have the latest OED code base.</ul><li>cd into the directory that has the cloned version of OED. This is known as the root directory of OED. It has a README.md file and others. What follows assumes you are in the root directory of OED (as is the default when you clone).<li><p>Edit <code>docker-compose.yml</code>. Note that for values with an = you should not put spaces before or after the equal sign as is shown in the sample value. The edits are:<ol><li>POSTGRES_PASSWORD (under <code>services: -&gt; datebase: -&gt; environment:</code>) to a site specific password instead of the <code>pleaseChange</code> that is provided. Keep it secret but you should never need to know this value unless you want to access the PostgreSQL database outside of the docker container. It will be: <code>- POSTGRES_PASSWORD=whateverPasswordYouChoose</code><li>OED_PRODUCTION (under <code>services: -&gt; web: -&gt; environment:</code>) to <code>yes</code> so it becomes: <code>- OED_PRODUCTION=yes</code>.<li>OED_TOKEN_SECRET (under <code>services: -&gt; web: -&gt; environment:</code>) to a random value instead of the <code>?</code> that is provided. Keep it secret but you should never need to know this value. It will be: <code>- OED_TOKEN_SECRET=whateverTokenYouChoose</code><li>The port (in <code>services: -&gt; web: -&gt; ports:</code>) to a mapping from host to container; e.g., to host on your computer's port 80, set it to <code>80:3000</code>. This assumes you want to serve OED up on the standard web port. There are multiple lines here and some are commented out (begin with <code>#</code>). Before you edit it should look like:<pre><code>
    ports:
        - "3000:3000" # Should be commented out if you uncomment 80:3000 below.
        - "9229:9229" # Debug port, should be commented out for production
        # For production you might want something like:
        # - "80:3000"
        # and comment out the debug port and 3000:3000 line above
           </code></pre><p>If you want to have standard web requests (port 80) serve up OED then edit to look like (you comment out the debug port because it is not normally used in production):<pre><code>
    ports:
        # - "3000:3000" # Should be commented out if you uncomment 80:3000 below.
        # - "9229:9229" # Debug port, should be commented out for production
        # For production you might want something like:
        - "80:3000"
        # and comment out the debug port and 3000:3000 line above
                 </code></pre><p>It is possible to use a different port. For example, if you leave the line <code>- "3000:3000"</code> uncommented and comment out <code>- "9229:9229"</code> then OED will server up on port 3000 (where you leave the <code>- "80:3000"</code> line commented out).<li>OED_SITE_READING_RATE (under <code>services: -&gt; web: -&gt; environment:</code>) might need to be updated. This represents the typical rate that meters at your site provide data. This impacts when OED switches from daily to hourly to original meter data when doing line graphics. The default value is 00:15:00 meaning the meter data is expected every 15 minutes. If the value is roughly right then there should be no issues. Note you do not change OED_TEST_SITE_READING_RATE as that is used internally for the automated tests in OED. More information is available on the help pages.<li>Later in these directions, it is suggested you set up a cron job to send an email to someone each day with any issues the OED installation encountered. For this to work, OED needs to have access to a mail system (SMTP server) to send the mail. To do this you need to set these environment values under <code>services: -&gt; web: -&gt; environment:</code><ul><li>OED_MAIL_METHOD gives the way email is sent (SMTP). As the comment says this can be <code>secure-smtp</code> to use your SMTP server or <code>none</code> if you are not going to have OED send mail alerts. OED only supports sending mail via secure channels. Note that the SMTP listed here does not have to relate to the mail recipient. In the end, this usually becomes <code>OED_MAIL_METHOD=secure-smtp</code>.<li>OED_MAIL_SMTP gives the web address of the SMTP server you are using. For example, it could be <code>OED_MAIL_SMTP=smtp.example.com</code> where example.com would become the domain for your organization or you could use <code>OED_MAIL_SMTP=smtp.gmail.com</code> for Google Mail.<li>OED_MAIL_SMTP_PORT gives the port number of the SMTP server you are using. For example, it is often <code>OED_MAIL_SMTP_PORT=465</code> for the standard SSL connection port.<li>OED_MAIL_IDENT gives the user name on the SMTP server where the mail will be sent. Replace <code>someone@example.com</code> with your user name email.<li>OED_MAIL_CREDENTIAL gives the password for the SMTP user in OED_MAIL_IDENT. Replace <code>credential</code> with that password. Note this setup cannot accommodate two factor authentication (2FA) unless you have access to a token for the credential (an app password for mail for Google has been tested and it works).<li>OED_MAIL_FROM give the email address that the mail will be from. This is often the same as the OED_MAIL_IDENT so it might be <code>OED_MAIL_FROM=mydomain@example.com</code> where you use the desired email address.<li>OED_MAIL_TO gives the email address of who will get the emails. Replace <code>someone@example.com</code> with the desired email. It can be the same as the SMTP email above or something different.<li>OED_MAIL_ORG gives the organization name that will be part of the subject of the email sent. This may be important in recognizing the email, esp. if the person receiving it gets email from multiple OED sites (not common). Replace <code>My Organization Name</code> with whatever name you want.</ul></ul></ol><li>For the remaining steps you need to be the superuser/root to have sufficient permission to modify system files. On some OS setups you can do the install step (next) without being the superuser but it is generally safer to not to try.<li>Make sure you are in the root OED directory (where the README.md file is located).<li>Install OED on the server by doing <code>docker compose up</code>. (On older versions of Docker you must do <code>docker-compose up</code>.) This will get all the needed software including Postgres, all node packages and then installs all the needed software. This can take from a minute to 10+ minutes depending on the speed of your server. You will see a lot of output about installing the database (Postgres), getting needed packages (<strong>this can take a while so you may not see output for a while</strong> normally happening right after the " database system is ready to accept connections" output line) and starting up the web system. When you see the lines:<pre>
oed-web-1       | &lt;s&gt; [webpack.Progress] 100% 
oed-web-1       | 
oed-web-1       | ℹ ｢atl｣: Time: 24033ms    
            </pre>then OED should be ready to accept web requests, where the actual number of hidden modules will likely be different. Note is says is is listening on port 3000 since that is what OED listens on but the ports: changes you made above mean the web requests to port 80 (or whatever you chose) will be sent on to port 3000 for OED. If there was an error in the output then OED might not be running properly. Please contact the OED project if you have questions where sending the terminal text is generally very helpful.<p>If you quickly get the error <code>Invalid interpolation format for "command" option in service "web": "${install_args:-}"</code> then it is likely you are running an older version of docker-compose (less than version 2). You can fix this error by editing the docker-compose.yml file (as you did above). At the end of the file you will see (Note OED v0.7.0 and earlier does not have the last three lines to deal with older versions of docker compose so you will need to add them during your edits. It also has the reverse proxy line comment that has since been removed.): <code><pre>
                # Lets docker-compose up work right
                # If environment variable install_args is not set the it becomes blank without warning user.
                command: ["bash", "./src/scripts/installOED.sh", "${install_args:-}"]
                # Use this if you are using a docker-compose that is earlier than version 2 and comment out the one above.
                # command: ["bash", "./src/scripts/installOED.sh"]
            </pre></code><p>Edit this to be: <code><pre>
                # Lets docker-compose up work right
                # If environment variable install_args is not set the it becomes blank without warning user.
                # command: ["bash", "./src/scripts/installOED.sh", "${install_args:-}"]
                # Use this if you are using a docker-compose that is earlier than version 2 and comment out the one above.
                command: ["bash", "./src/scripts/installOED.sh"]
            </pre></code><p>If you redo the <code>docker compose up</code> then you should now get the expected output described above.<p>The <a href="../adminInstallOutput/">typical output of the install</a> is available.<li>You can now use a web browser to check that OED is properly serving up web pages. Use the web address <code>oed.myinstition.org</code> where you replace oed.myinstition.org with the name of the server where you installed OED. If all is working properly you will see the main OED page (see <a href="../graphType/">Graph Type</a> help page for an image of what it will look like). You won't be able to graph any data until you have OED acquire meter data. If you did not do the mapping of 80:3000 above, then OED would be reachable at <code>oed.myinstition.org:3000</code>.<li>You now need to create an admin user so you can log into OED on the website. To do this you will need a second terminal where you go to the root OED directory and are a superuser/root (as you have been). This is done so you don't have to shut down OED to add the user. Run the script with: <code>docker compose run web npm run createUser</code>. The code will prompt you to enter an email address and password:<pre>
# docker compose run web npm run createUser
Starting checkoed_database_1 ... done

> Open-Energy-Dashboard@0.6.0 createUser
> node ./src/server/services/user/createUser.js

Email of user to create: someEmail@yourInstitution.org
Password: passwordYouChoose
[INFO@2021-10-13T21:40:31.853Z] User created or already exists
            </pre>where you replace <code>someEmail@yourInstitution.org</code> with any email (it does not have to be an active one) and <code>passwordYouChoose</code> with the password you want to use with this email to login to OED (passwords must be at least 8 characters long). It is important to remember this email & password so you have access to OED admin features on the web pages. You can run the command <code>docker compose run web npm run editUser</code> to change the password if you forget it or you can create a new user. Note an OED admin user can create more users on the site so this is normally a one-time step.<p>Note that OED echos what you type so this information will be in the terminal. You shouldn't need this terminal any more so you can close it to hide the information or usually type <code>clear</code> to remove it from what is shown in the terminal.<p>You should now log in to make sure this account works. <a href="../admin/">Logging in</a> directions are available but basically you click the "Log in" button in the top, right of the OED website and then enter the information.<li>Shut down OED. You will soon be setting up OED to run as a service so you want to stop the one running in the terminal. In the terminal where you started OED (with <code>docker compose up</code>), do "^c" to shut down OED. Be a little patient since doing a second "^c" will cause a rapid stop of docker without the normal cleanup.<li>In the following steps you need to know the root directory of OED. In the terminal where you are in the OED root directory do: <code>pwd</code> and the output will tell you the directory path.<li><p>Set up the daily cron job to email the OED admin with any issues that occurred in the past day. You are not required to do this but it is a very good idea. It gives someone a daily email of any issue so they are not missed. See above about needed values in docker-compose.yml to support sending emails.<ol><li>In the root OED directory do: <code>cp src/scripts/sendLogEmailCron.bash /etc/cron.daily/sendLogEmailCron.bash</code><li>Edit /etc/cron.daily/sendLogEmailCron.bash to make the necessary modifications to the script. See the script for more detail.<li>Do: <code>chmod +x /etc/cron.daily/sendLogEmailCron.bash</code> to make the script executable.</ol><li><p>Set up the daily cron job to aggregate the daily readings needed for the fast data access OED does to the database.<ol><li>In the root OED directory do: <code>cp src/scripts/refreshReadingViewsCron.bash /etc/cron.daily/refreshReadingViewsCron.bash</code><li>Edit /etc/cron.daily/refreshReadingViewsCron.bash to make the necessary modifications to the script. See the script for more detail.<li>Do: <code>chmod +x /etc/cron.daily/refreshReadingViewsCron.bash</code> to make the script executable.</ol><li><p>Set up the cron job to aggregate the hourly readings needed for the fast data access OED does to the database when zoomed in on data. The site can choose how frequently to do this. If you want to see the latest meter data quickly then this should be done hourly. Note the update takes a modest amount of CPU and can delay when users see data. If you prefer, you could run the script daily just before running the daily updates. This would mean the new hourly data would only become visible after the day completes.<ol><li>In the root OED directory do (this assumes you do the update every hour): <code>cp src/scripts/refreshHourlyReadingViewsCron.bash /etc/cron.hourly/refreshHourlyReadingViewsCron.bash</code><li>Edit /etc/cron.daily/refreshHourlyReadingViewsCron.bash to make the necessary modifications to the script. See the script for more detail but it should be the same as the daily script changes.<li>Do: <code>chmod +x /etc/cron.hourly/refreshHourlyReadingViewsCron.bash</code> to make the script executable.</ol><li><p>Set up the service so OED runs regularly on your system. There is a chance that your version of Unix requires a modification of these steps. These steps should work on a Red Hat/Centos Unix. The "User" you need to set below is the one assigned to OED, the one you logged in as before becoming superuser/root or (hopefully not) the superuser/root.<ol><li>In the root OED directory do: <code>cp src/scripts/oed.service /etc/systemd/system/oed.service</code><li>Edit /etc/systemd/system/oed.service to make the necessary modifications to the script. See the script for more detail.<li>Do: <code>systemctl enable oed.service</code> to make the service start on server boot.<li>Assuming you want to start OED at this time do: <code>systemctl start oed.service</code>. Stop the app at any time by doing: <code>systemctl stop oed.service</code> but note it will restart on the next reboot unless you disable this service with: <code>systemctl disable oed.service</code>.<li>To check the status of the OED service do: <code>systemctl list-units --type=service | grep -i oed</code>. Note that OED needs to reinstall/restart when you start the service again so it will take a little while from the time this lists the service as loaded and active running until it is ready to serve up web pages.<li>If you want to check this is all set up correctly then restart the server and check it is still serving up web pages (as described above).</ol><li>Sometimes you want to see the output of OED when it is running as a service. This can be useful during the install if you want to see why OED did not come up. You do this by:<ol><li>Get the container ID by using: <code>docker ps -a</code>. The CONTAINER ID will be the one with the IMAGE of ...oed_web (where there may be some name in the ...) for the install/web output and IMAGE of ...oed_database for any database output.<li><code>docker logs &lt;CONTAINER ID&gt; | more</code> where you replace &lt;CONTAINER ID&gt; with the one you want from the previous step.</ol><li>You will want to get meter data into OED so the site can display data. See the <a href="../adminDataAcquisition/">data acquisition</a> page for more information on doing this.</ol><h1>OED upgrades</h1><p>The OED project is regularly improving the code and releasing new versions of OED. To get the latest features, you will probably want to upgrade OED over time. Information on officially released and tagged versions is given on the <a href="https://github.com/OpenEnergyDashboard/OED/releases" rel="noopener noreferrer">OED GitHub release page</a>. If you see a newer version that you want to upgrade to then consult the directions on the <a href="../adminUpgrading/">OED Upgrading page</a>.<h1>Other information</h1><p>Though less likely, you may want to consult:<ul><li><a href="https://openenergydashboard.org/developer/environment/">Environment variable</a> page about all the OED environment variables.<li><a href="https://openenergydashboard.org/developer/npm/">NPM script</a> page about the available scripts to support the OED setup.</ul><p>It is rare that the node/npm installation is not okay in a production environment. The OED installation detects if the node install already happened (because there is a node_modules directory in the root OED directory) and skips doing it again to save time. However you can force OED to do the node install by going to the root OED directory and deleting the node_modules directory with: <code>rm -rf node_modules/</code>. Make sure OED is not running (see stopping the service above) before you do this since it will break the application. Redoing the OED install with <code>docker compose up</code> will recreate this directory.</div></div></article></div></div><div id="up-to-top" class="row"><div class="small-12 columns" style="text-align: right;"> <a class="iconfont" href="#top-of-page">&#xf108;</a></div></div><footer id="footer-content" class="bg-grau"><div id="footer"><div class="row"> <noscript><div class="alert-box warning "><p>Some aspect of this site will not work and others will work better if you enable JavaScript.</div></noscript></div><div class="row"><div class="medium-6 large-5 columns"><h5 class="shadow-black">About This Site</h5><p class="shadow-black"> The OED dashboard allows organization to acquire, archive, analyze and display energy/resource usage. <a href="https://openenergydashboard.org/features/">More ›</a></div><div class="small-6 medium-3 large-3 large-offset-1 columns"><h5 class="shadow-black">Services</h5><ul class="no-bullet shadow-black"><li > <a href="https://openenergydashboard.org/" title=""></a><li > <a href="https://openenergydashboard.org/contact/" title="Contact">Contact</a><li > <a href="https://openenergydashboard.org/sitemap.xml" title="Sitemap for Google Webmaster Tools">sitemap.xml</a></ul></div><div class="small-6 medium-3 large-3 columns"><ul class="no-bullet shadow-black"></ul></div></div></div><div id="subfooter"><nav class="row"><section id="subfooter-left" class="small-12 medium-6 columns credits"><p>Created by the OED team using <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> based on <a href="https://phlow.github.io/feeling-responsive/">Feeling Responsive</a>. This page is part of the Open Energy Dashboard and is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed with this file, you can obtain one at <a href="https://www.mozilla.org/en-US/MPL/2.0/" rel="nofollow">https://www.mozilla.org/en-US/MPL/2.0/</a>.</section><section id="subfooter-right" class="small-12 medium-6 columns"><ul class="inline-list social-icons"><li><a href="https://github.com/OpenEnergyDashboard/OED" target="_blank" class="icon-github" title="Code other repos..."></a></ul></section></nav></div></footer><script src="https://openenergydashboard.org/assets/js/javascript.min.js"></script>
